 <!DOCTYPE html> <html> <head><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootswatch/3.2.0/readable/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="https://cdn.rawgit.com/hammerlab/ketrew/2d1c430cca52caa71e363a765ff8775a6ae14ba9/src/doc/code_style.css" type="text/css"><meta charset="utf-8"><title>Atd2cconv: Home</title></head><body><div class="container"><h1>Atd2cconv: Home</h1><div class="row">
<div class="col-md-3">
<h2>Contents</h2><ul><li><a href='#Build'>Build</a>
</li><li><a href='#Usage'>Usage</a>
<ul><li><a href='#Library'>Library</a>
</li><li><a href='#Application'>Application</a>
</li></ul>
</li><li><a href='#Example'>Example</a>
</li></ul><h2>Menu</h2><ul><li><a href='index.html'>Home</a></li><li><a href='main.html'>Application Implementation</a></li><li><a href='atd2cconv.html'>Library Implementation</a></li><li><a href='./api/index.html'>API Documentation</a></li><li><a href='../index.html'><code>master</code></a> branch</li><li>Repository <a href='https://github.com/smondet/atd2cconv'>at Github</a></li><li>Up: <a href='../../index.html'>Software Projects</a></li></ul></div><div class="col-md-9"><h1 id="ATDToOCamlCConv">ATD To OCaml+CConv</h1>

<p>This a tiny library and an application transforming (a subset of possible)
<a href='https://github.com/mjambon/atd/blob/master/atd_ast.mli'>ATD</a>
type definitions to OCaml modules that define
<a href='https://github.com/c-cube/cconv'>CConv</a> sources and sinks.</p>
<p><strong>Warning:</strong> This first version (<code>0.0.0</code>) only generates code for
<strong>CConv version 0.1</strong> (even though it does not actually depend on it).</p>
<h2 id="Build">Build</h2>

<p>Just type:</p>
<pre><code>make
make install BINDIR=/some/where/bin</code></pre><h2 id="Usage">Usage</h2>

<h3 id="Library">Library</h3>

<p>The library has a single function: <a href='api/Atd2cconv.html#VALtransform_module_item' title='Atd2cconv.transform_module_item'><code>Atd2cconv.transform_module_item</code></a>
(see <a href='api/Atd2cconv.html'><code>atd2cconv.mli</code></a>, and its use in
<a href='main.html'><code>main.ml</code></a>):</p>
<pre><span class="kw1">match</span><span class="text"> </span><span class="kw2">Atd2cconv</span><span class="text">.</span><span class="id">transform_module_item</span><span class="text"> </span><span class="id">item</span><span class="text"> </span><span class="kw1">with</span><span class="text">
| `</span><span class="kw2">Ok</span><span class="text"> </span><span class="id">doc</span><span class="text"> -&gt;
  </span><span class="kw2">SmartPrint</span><span class="text">.</span><span class="id">to_stdout</span><span class="text"> </span><span class="numeric">78</span><span class="text"> </span><span class="numeric">2</span><span class="text"> </span><span class="id">doc</span><span class="text">;
| `</span><span class="kw2">Error</span><span class="text"> (`</span><span class="kw2">Not_implemented</span><span class="text"> </span><span class="id">msg</span><span class="text">) -&gt;
  </span><span class="id">failwithf</span><span class="text"> </span><span class="string">&quot;Error: %S not implemented&quot;</span><span class="text"> </span><span class="id">msg</span></pre>

<h3 id="Application">Application</h3>

<p>There are very few options:</p>
<pre><code>atd2cconv [-inline-inherit-variants (true|false)] -i types.atd -o impl.ml</code></pre><p>The default value for <code>-inline-inherit-variants</code> is <code>true</code>, and this is
recommended; it means that the keyword <code>inherit</code> in ATD variant types
descriptions will result in “expanded” variants.</p>
<h2 id="Example">Example</h2>

<p>The idea of <code>atd2cconv</code> (in contrast to <code>atdgen</code>) is to not use <code>Obj.magic</code>,
ever, and to make modules and types definitions more “standard” so that they
can be used more uniformly within functors and/or first class modules.</p>
<pre><span class="kw">type</span><span class="text"> </span><span class="id">ext_type</span><span class="text"> &lt;</span><span class="id">ocaml</span><span class="text"> </span><span class="id">from</span><span class="text">=</span><span class="string">&quot;AnotherModule&quot;</span><span class="text">&gt; = </span><span class="id">abstract</span><span class="text">
</span><span class="kw">type</span><span class="text"> </span><span class="id">simple_record</span><span class="text"> = {
  </span><span class="id">one</span><span class="text">: </span><span class="id">ext_type</span><span class="text">;
  </span><span class="id">two</span><span class="text">: </span><span class="kw3">string</span><span class="text"> </span><span class="kw3">list</span><span class="text"> </span><span class="id">option</span><span class="text">;
  </span><span class="id">three</span><span class="text">: [</span><span class="kw2">Int</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="kw3">int</span><span class="text"> | </span><span class="kw2">Float</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="kw3">float</span><span class="text">];
}
</span><span class="kw">type</span><span class="text"> </span><span class="id">simple_variant</span><span class="text"> = [
  | </span><span class="kw2">One</span><span class="text">
  | </span><span class="kw2">Two</span><span class="text"> </span><span class="kw">of</span><span class="text"> (</span><span class="id">simple_record</span><span class="text"> * </span><span class="kw3">int</span><span class="text">)
  | </span><span class="kw2">Rec</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="id">simple_variant</span><span class="text">
  | </span><span class="kw2">Double</span><span class="text"> </span><span class="kw">of</span><span class="text"> (</span><span class="kw3">int</span><span class="text"> * </span><span class="kw3">string</span><span class="text">) </span><span class="kw3">list</span><span class="text">
]
</span><span class="kw">type</span><span class="text"> </span><span class="id">inheriting</span><span class="text"> = [
  | </span><span class="kw2">One_more</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="kw3">int</span><span class="text"> </span><span class="id">option</span><span class="text">
  | </span><span class="kw2">Rec</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="id">simple_variant</span><span class="text">
  | </span><span class="kw2">I</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="id">simple_record</span><span class="text">
  | </span><span class="kw">inherit</span><span class="text"> </span><span class="id">simple_variant</span><span class="text">
]</span></pre>

<p>will result in (implementations truncated for simplicity):</p>
<pre><span class="kw">module</span><span class="text"> </span><span class="kw">rec</span><span class="text">  </span><span class="kw2">Ext_type</span><span class="text"> : </span><span class="kw1">sig</span><span class="text">
  </span><span class="kw">type</span><span class="text"> </span><span class="id">t</span><span class="text"> = </span><span class="kw2">AnotherModule</span><span class="text">.</span><span class="id">t</span><span class="text">
  </span><span class="kw">val</span><span class="text"> </span><span class="id">source</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Source</span><span class="text">.</span><span class="id">t</span><span class="text">
  </span><span class="kw">val</span><span class="text"> </span><span class="id">sink</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Sink</span><span class="text">.</span><span class="id">t</span><span class="text">
</span><span class="kw1">end</span><span class="text"> = </span><span class="kw1">struct</span><span class="text">
  </span><span class="kw">type</span><span class="text">  </span><span class="id">t</span><span class="text"> = </span><span class="kw2">AnotherModule</span><span class="text">.</span><span class="id">t</span><span class="text">
  </span><span class="kw">type</span><span class="text">  </span><span class="id">t_alias</span><span class="text"> =  </span><span class="id">t</span><span class="text">
  </span><span class="kw">let</span><span class="text"> </span><span class="id">source</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Source</span><span class="text">.</span><span class="id">t</span><span class="text"> = </span><span class="comment">(* … *)</span><span class="text">
  </span><span class="kw">let</span><span class="text"> </span><span class="id">sink</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Sink</span><span class="text">.</span><span class="id">t</span><span class="text"> = </span><span class="comment">(* … *)</span><span class="text">
</span><span class="kw1">end</span><span class="text">
</span><span class="kw">module</span><span class="text"> </span><span class="kw">rec</span><span class="text">  </span><span class="kw2">Simple_record</span><span class="text"> : </span><span class="kw1">sig</span><span class="text">
  </span><span class="kw">type</span><span class="text"> </span><span class="id">t</span><span class="text"> = {
    </span><span class="id">one</span><span class="text">: </span><span class="kw2">Ext_type</span><span class="text">.</span><span class="id">t</span><span class="text">;
    </span><span class="id">two</span><span class="text">: </span><span class="kw3">string</span><span class="text"> </span><span class="kw3">list</span><span class="text"> </span><span class="id">option</span><span class="text">;
    </span><span class="id">three</span><span class="text">: [
        | `</span><span class="kw2">Int</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="kw3">int</span><span class="text">
        | `</span><span class="kw2">Float</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="kw3">float</span><span class="text">
      ];
  }
  </span><span class="kw">val</span><span class="text"> </span><span class="id">source</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Source</span><span class="text">.</span><span class="id">t</span><span class="text">
  </span><span class="kw">val</span><span class="text"> </span><span class="id">sink</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Sink</span><span class="text">.</span><span class="id">t</span><span class="text">
</span><span class="kw1">end</span><span class="text"> = </span><span class="kw1">struct</span><span class="text">
  </span><span class="kw">type</span><span class="text">  </span><span class="id">t</span><span class="text"> = { </span><span class="comment">(* … *)</span><span class="text"> }
  </span><span class="kw">let</span><span class="text"> </span><span class="id">source</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Source</span><span class="text">.</span><span class="id">t</span><span class="text"> = </span><span class="comment">(* … *)</span><span class="text">
  </span><span class="kw">let</span><span class="text"> </span><span class="id">sink</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Sink</span><span class="text">.</span><span class="id">t</span><span class="text"> = </span><span class="comment">(* … *)</span><span class="text">
</span><span class="kw1">end</span><span class="text">
</span><span class="kw">module</span><span class="text"> </span><span class="kw">rec</span><span class="text">  </span><span class="kw2">Simple_variant</span><span class="text"> : </span><span class="kw1">sig</span><span class="text">
  </span><span class="kw">type</span><span class="text"> </span><span class="id">t</span><span class="text"> = [
    | `</span><span class="kw2">One</span><span class="text">
    | `</span><span class="kw2">Two</span><span class="text"> </span><span class="kw">of</span><span class="text"> (</span><span class="kw2">Simple_record</span><span class="text">.</span><span class="id">t</span><span class="text"> * </span><span class="kw3">int</span><span class="text">)
    | `</span><span class="kw2">Rec</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="id">t</span><span class="text">
    | `</span><span class="kw2">Double</span><span class="text"> </span><span class="kw">of</span><span class="text"> (</span><span class="kw3">int</span><span class="text"> * </span><span class="kw3">string</span><span class="text">) </span><span class="kw3">list</span><span class="text">
  ]
  </span><span class="kw">val</span><span class="text"> </span><span class="id">source</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Source</span><span class="text">.</span><span class="id">t</span><span class="text">
  </span><span class="kw">val</span><span class="text"> </span><span class="id">sink</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Sink</span><span class="text">.</span><span class="id">t</span><span class="text">
</span><span class="kw1">end</span><span class="text"> = </span><span class="kw1">struct</span><span class="text">
  </span><span class="kw">type</span><span class="text">  </span><span class="id">t</span><span class="text"> = [ </span><span class="comment">(* … *)</span><span class="text"> ]
  </span><span class="kw">let</span><span class="text"> </span><span class="id">source</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Source</span><span class="text">.</span><span class="id">t</span><span class="text"> = </span><span class="comment">(* … *)</span><span class="text">
  </span><span class="kw">let</span><span class="text"> </span><span class="id">sink</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Sink</span><span class="text">.</span><span class="id">t</span><span class="text"> = </span><span class="comment">(* … *)</span><span class="text">
</span><span class="kw1">end</span><span class="text">
</span><span class="kw">module</span><span class="text"> </span><span class="kw">rec</span><span class="text">  </span><span class="kw2">Inheriting</span><span class="text"> : </span><span class="kw1">sig</span><span class="text">
  </span><span class="kw">type</span><span class="text"> </span><span class="id">t</span><span class="text"> = [
    | `</span><span class="kw2">One_more</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="kw3">int</span><span class="text"> </span><span class="id">option</span><span class="text">
    | `</span><span class="kw2">I</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="kw2">Simple_record</span><span class="text">.</span><span class="id">t</span><span class="text">
    | `</span><span class="kw2">One</span><span class="text">
    | `</span><span class="kw2">Two</span><span class="text"> </span><span class="kw">of</span><span class="text"> (</span><span class="kw2">Simple_record</span><span class="text">.</span><span class="id">t</span><span class="text"> * </span><span class="kw3">int</span><span class="text">)
    | `</span><span class="kw2">Rec</span><span class="text"> </span><span class="kw">of</span><span class="text"> </span><span class="kw2">Simple_variant</span><span class="text">.</span><span class="id">t</span><span class="text">
    | `</span><span class="kw2">Double</span><span class="text"> </span><span class="kw">of</span><span class="text"> (</span><span class="kw3">int</span><span class="text"> * </span><span class="kw3">string</span><span class="text">) </span><span class="kw3">list</span><span class="text">
  ]
  </span><span class="kw">val</span><span class="text"> </span><span class="id">source</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Source</span><span class="text">.</span><span class="id">t</span><span class="text">
  </span><span class="kw">val</span><span class="text"> </span><span class="id">sink</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Sink</span><span class="text">.</span><span class="id">t</span><span class="text">
</span><span class="kw1">end</span><span class="text"> = </span><span class="kw1">struct</span><span class="text">
  </span><span class="kw">type</span><span class="text">  </span><span class="id">t</span><span class="text"> = [ </span><span class="comment">(* … *)</span><span class="text"> ]
  </span><span class="kw">let</span><span class="text"> </span><span class="id">source</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Source</span><span class="text">.</span><span class="id">t</span><span class="text"> = </span><span class="comment">(* … *)</span><span class="text">
  </span><span class="kw">let</span><span class="text"> </span><span class="id">sink</span><span class="text"> : </span><span class="kw3">unit</span><span class="text"> -&gt; </span><span class="id">t</span><span class="text"> </span><span class="kw2">CConv</span><span class="text">.</span><span class="kw2">Sink</span><span class="text">.</span><span class="id">t</span><span class="text"> = </span><span class="comment">(* … *)</span><span class="text">
</span><span class="kw1">end</span></pre></div></div></div></body><html>