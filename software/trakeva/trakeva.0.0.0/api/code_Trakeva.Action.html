<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Main" rel="Chapter" href="Main.html">
<link title="Trakeva" rel="Chapter" href="Trakeva.html">
<link title="Trakeva_cache" rel="Chapter" href="Trakeva_cache.html">
<link title="Trakeva_sqlite" rel="Chapter" href="Trakeva_sqlite.html"><title>Trakeva API : Trakeva.Action</title>
</head>
<body>
<code class="code">:&nbsp;<span class="keyword">sig</span><br>
<br>
&nbsp;&nbsp;<span class="keyword">type</span>&nbsp;t&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Set</span>&nbsp;<span class="keyword">of</span>&nbsp;<span class="constructor">Key_in_collection</span>.t&nbsp;*&nbsp;string<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Unset</span>&nbsp;<span class="keyword">of</span>&nbsp;<span class="constructor">Key_in_collection</span>.t<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Sequence</span>&nbsp;<span class="keyword">of</span>&nbsp;t&nbsp;list<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Check</span>&nbsp;<span class="keyword">of</span>&nbsp;<span class="constructor">Key_in_collection</span>.t&nbsp;*&nbsp;string&nbsp;option<br>
&nbsp;&nbsp;&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** An action is a transaction that (attempts) to modify the database. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;set&nbsp;:&nbsp;?collection:string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;key:string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;t<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Create a “set” action: <code class="code">set ~key v</code> will add or set the value <code class="code">v</code> for the
      key <code class="code">key</code>, optionally in the collection <code class="code">collection</code>. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;seq&nbsp;:&nbsp;t&nbsp;list&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;t<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Put a sequence of actions into a transaction. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;contains&nbsp;:&nbsp;?collection:string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;key:string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;t<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** An action that checks that the <code class="code">key</code> is set in the DB and has the given
      value. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;is_not_set&nbsp;:&nbsp;?collection:string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;t<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** An action that checks that the <code class="code">key</code> is not set in the DB. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;unset:&nbsp;?collection:string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;t<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** An actions that removes a value from the DB. *)</span></td></tr></table><code class="code"><br>
<br>
&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;to_string:&nbsp;t&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;string<br>
&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;</td><td><span class="comment">(** Convert the action to a display friendly string (the
      implementation is quite naive and not tail-recursive, hence avoid
      displaying huge transaction). *)</span></td></tr></table><code class="code"><br>
<span class="keyword">end</span>&nbsp;=&nbsp;<span class="keyword">struct</span><br>
<br>
&nbsp;&nbsp;<span class="keyword">type</span>&nbsp;t&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Set</span>&nbsp;<span class="keyword">of</span>&nbsp;<span class="constructor">Key_in_collection</span>.t&nbsp;*&nbsp;string<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Unset</span>&nbsp;<span class="keyword">of</span>&nbsp;<span class="constructor">Key_in_collection</span>.t<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Sequence</span>&nbsp;<span class="keyword">of</span>&nbsp;t&nbsp;list<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Check</span>&nbsp;<span class="keyword">of</span>&nbsp;<span class="constructor">Key_in_collection</span>.t&nbsp;*&nbsp;string&nbsp;option<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;_key&nbsp;?collection&nbsp;key&nbsp;=&nbsp;{<span class="constructor">Key_in_collection</span>.&nbsp;key;&nbsp;collection}<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;set&nbsp;?collection&nbsp;~key&nbsp;value&nbsp;=&nbsp;<span class="constructor">Set</span>&nbsp;(_key&nbsp;?collection&nbsp;key,&nbsp;value)<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;seq&nbsp;l&nbsp;=&nbsp;<span class="constructor">Sequence</span>&nbsp;l<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;contains&nbsp;?collection&nbsp;~key&nbsp;v&nbsp;=&nbsp;<span class="constructor">Check</span>&nbsp;(_key&nbsp;?collection&nbsp;key,&nbsp;<span class="constructor">Some</span>&nbsp;v)&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;is_not_set&nbsp;?collection&nbsp;key&nbsp;=&nbsp;<span class="constructor">Check</span>&nbsp;(_key&nbsp;?collection&nbsp;key,&nbsp;<span class="constructor">None</span>)<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;unset&nbsp;?collection&nbsp;key&nbsp;=&nbsp;<span class="constructor">Unset</span>&nbsp;(_key&nbsp;?collection&nbsp;key)<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;to_string&nbsp;(t:&nbsp;t)&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;t&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Set</span>&nbsp;(k,&nbsp;v)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;sprintf&nbsp;<span class="string">"(set&nbsp;%s&nbsp;%S)"</span>&nbsp;(<span class="constructor">Key_in_collection</span>.to_string&nbsp;k)&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Unset</span>&nbsp;k&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;sprintf&nbsp;<span class="string">"(unset&nbsp;%s)"</span>&nbsp;(<span class="constructor">Key_in_collection</span>.to_string&nbsp;k)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Sequence</span>&nbsp;l&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;sprintf&nbsp;<span class="string">"(sequence&nbsp;%s)"</span>&nbsp;(<span class="constructor">List</span>.map&nbsp;l&nbsp;~f:to_string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&gt;&nbsp;<span class="constructor">StringLabels</span>.concat&nbsp;~sep:<span class="string">"&nbsp;"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Check</span>&nbsp;(k,&nbsp;v)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf&nbsp;<span class="string">"(check&nbsp;%s&nbsp;%s)"</span>&nbsp;(<span class="constructor">Key_in_collection</span>.to_string&nbsp;k)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="constructor">Option</span>.value_map&nbsp;~default:<span class="string">"None"</span>&nbsp;v&nbsp;~f:(sprintf&nbsp;<span class="string">"(Some&nbsp;%S)"</span>))<br>
<br>
<span class="keyword">end</span></code></body></html>