<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Sosa" rel="Chapter" href="Sosa.html"><title>Sosa.Int_utf8_character.write_to_native_string</title>
</head>
<body>
<code class="code"><span class="keyword">let</span>&nbsp;write_to_native_string&nbsp;c&nbsp;~buf&nbsp;~index&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sz&nbsp;=&nbsp;size&nbsp;c&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;first_byte&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;sz&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;1&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;((c&nbsp;<span class="keyword">lsr</span>&nbsp;&nbsp;0)&nbsp;<span class="keyword">land</span>&nbsp;0b0111_1111)&nbsp;<span class="keyword">lor</span>&nbsp;0b0000_0000<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;2&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;((c&nbsp;<span class="keyword">lsr</span>&nbsp;&nbsp;6)&nbsp;<span class="keyword">land</span>&nbsp;0b0001_1111)&nbsp;<span class="keyword">lor</span>&nbsp;0b1100_0000<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;3&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;((c&nbsp;<span class="keyword">lsr</span>&nbsp;12)&nbsp;<span class="keyword">land</span>&nbsp;0b0000_1111)&nbsp;<span class="keyword">lor</span>&nbsp;0b1110_0000<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;4&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;((c&nbsp;<span class="keyword">lsr</span>&nbsp;18)&nbsp;<span class="keyword">land</span>&nbsp;0b0000_0111)&nbsp;<span class="keyword">lor</span>&nbsp;0b1111_0000<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;5&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;((c&nbsp;<span class="keyword">lsr</span>&nbsp;24)&nbsp;<span class="keyword">land</span>&nbsp;0b0000_0011)&nbsp;<span class="keyword">lor</span>&nbsp;0b1111_1000<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;6&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;((c&nbsp;<span class="keyword">lsr</span>&nbsp;30)&nbsp;<span class="keyword">land</span>&nbsp;0b0000_0001)&nbsp;<span class="keyword">lor</span>&nbsp;0b1111_1100<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">assert</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.[index]&nbsp;&lt;-&nbsp;char_of_int&nbsp;first_byte;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>&nbsp;i&nbsp;=&nbsp;2&nbsp;<span class="keyword">to</span>&nbsp;sz&nbsp;&nbsp;<span class="keyword">do</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ith_byte&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((c&nbsp;<span class="keyword">lsr</span>&nbsp;(6&nbsp;*&nbsp;(i&nbsp;-&nbsp;2)))&nbsp;<span class="keyword">land</span>&nbsp;0b0011_1111)&nbsp;<span class="keyword">lor</span>&nbsp;0b1000_0000&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.[index&nbsp;+&nbsp;sz&nbsp;-&nbsp;i&nbsp;+&nbsp;1]&nbsp;&lt;-&nbsp;char_of_int&nbsp;ith_byte;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">done</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;sz<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;fail&nbsp;<span class="keywordsign">`</span>out_of_bounds</code></body></html>