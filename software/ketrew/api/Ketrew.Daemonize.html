<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Ketrew.Configuration.html">
<link rel="next" href="Ketrew.Document.html">
<link rel="Up" href="Ketrew.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Ketrew_pure" rel="Chapter" href="Ketrew_pure.html">
<link title="Ketrew" rel="Chapter" href="Ketrew.html"><title>Ketrew API : Ketrew.Daemonize</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Ketrew.Configuration.html" title="Ketrew.Configuration">Previous</a>
&nbsp;<a class="up" href="Ketrew.html" title="Ketrew">Up</a>
&nbsp;<a class="post" href="Ketrew.Document.html" title="Ketrew.Document">Next</a>
</div>
<h1>Module <a href="type_Ketrew.Daemonize.html">Ketrew.Daemonize</a></h1>

<pre><span class="keyword">module</span> Daemonize: <code class="code"><span class="keyword">sig</span></code> <a href="Ketrew.Daemonize.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><hr width="100%">
<br>
Implementation of the <code class="code"><span class="constructor">LONG_RUNNING</span></code> API with <code class="code">nohup setsid</code> unix
    processes or generated Python scripts.<br>
<br>
Implementation of the <code class="code"><span class="constructor">LONG_RUNNING</span></code> API with <code class="code">nohup setsid</code> unix
    processes or generated Python scripts.<br>
<br>
This module implements the <a href="Ketrew.Long_running.LONG_RUNNING.html"><code class="code"><span class="constructor">Ketrew</span>.<span class="constructor">Long_running</span>.<span class="constructor">LONG_RUNNING</span></code></a> plugin-API.
<p>

    Shell commands are put in a <a href="Ketrew_pure.Monitored_script.html#TYPEt"><code class="code"><span class="constructor">Ketrew_pure</span>.<span class="constructor">Monitored_script</span>.t</code></a>, and
    run in the background (detached in a new process group).
<p>

    There are two methods for starting/detaching the computation
    (set with the <code class="code">~using</code> parameter): 
<p>
<ul>
<li><code class="code"><span class="keywordsign">`</span><span class="constructor">Nohup_setsid</span></code> (the default) means that the script will be started with
    <code class="code"><span class="string">"nohup setsid bash &lt;script&gt; &amp;"</span></code>.
    This method is the <i>POSIX-ly</i> portable one; but, sadly,
    it is broken on MacOSX
    (c.f. people having
    <a href="https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard">TMux problems</a>, 
    <a href="http://stackoverflow.com/questions/23898623/nohup-cant-detach-from-console">Nohup problems</a>).</li>
</ul>
<ul>
<li><code class="code"><span class="keywordsign">`</span><span class="constructor">Python_daemon</span></code> means that the script will be started by
    a generated Python script.
    Obviously, this works only when the host can run Python scripts (which
    includes MacOSX).</li>
</ul>

    The <code class="code">update</code> function uses the log-file of the monitored-script, and the
    command <code class="code"><span class="string">"ps -p &lt;Group-PID&gt;"</span></code>.
<p>

    The <code class="code">kill</code> function kills the process group (created thanks to <code class="code"><span class="string">"setsid"</span></code>)
    with <code class="code"><span class="string">"kill -- &lt;N&gt;"</span></code> (where <code class="code"><span class="string">"&lt;N&gt;"</span></code> is the negative PID of the group).<br>

<pre><span id="TYPErun_parameters"><span class="keyword">type</span> <code class="type"></code>run_parameters</span> </pre>


<pre><span id="VALrun_parameters_to_yojson"><span class="keyword">val</span> run_parameters_to_yojson</span> : <code class="type"><a href="Ketrew.Daemonize.html#TYPErun_parameters">run_parameters</a> -> Yojson.Safe.json</code></pre>
<pre><span id="VALrun_parameters_of_yojson"><span class="keyword">val</span> run_parameters_of_yojson</span> : <code class="type">Yojson.Safe.json -><br>       [ `Error of string | `Ok of <a href="Ketrew.Daemonize.html#TYPErun_parameters">run_parameters</a> ]</code></pre>
<pre><span class="keyword">include</span> Long_running.LONG_RUNNING</pre>
<div class="info ">
The “standard” plugin-API.<br>
</div>

<pre><span id="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">?starting_timeout:float -><br>       ?call_script:(string -> string list) -><br>       ?using:[ `Nohup_setsid | `Python_daemon ] -><br>       ?host:<a href="Ketrew_pure.Host.html#TYPEt">Ketrew_pure.Host.t</a> -><br>       ?no_log_is_ok:bool -><br>       <a href="Ketrew_pure.Program.html#TYPEt">Ketrew_pure.Program.t</a> -> [> `Long_running of string * string ]</code></pre><div class="info ">
Create a “long-running” <a href="Ketrew_pure.Target.html#VALbuild_process"><code class="code"><span class="constructor">Ketrew_pure</span>.<span class="constructor">Target</span>.build_process</code></a> (run parameters
    are already serialized), see <code class="code"><span class="constructor">Edsl</span>.daemonize</code> for more
    details<br>
</div>

<pre><span id="VALmarkup"><span class="keyword">val</span> markup</span> : <code class="type"><a href="Ketrew.Daemonize.html#TYPErun_parameters">run_parameters</a> -><br>       Ketrew_pure.Internal_pervasives.Display_markup.t</code></pre>
<pre><span id="VALget_playground"><span class="keyword">val</span> get_playground</span> : <code class="type"><a href="Ketrew.Daemonize.html#TYPErun_parameters">run_parameters</a> -> <a href="Ketrew_pure.Path.html#TYPEt">Ketrew_pure.Path.t</a> option</code></pre></body></html>