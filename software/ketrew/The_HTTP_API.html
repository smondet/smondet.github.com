 <!DOCTYPE html> <html> <head><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootswatch/3.2.0/readable/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="https://cdn.rawgit.com/hammerlab/ketrew/2d1c430cca52caa71e363a765ff8775a6ae14ba9/src/doc/code_style.css" type="text/css"><meta charset="utf-8"><title>Ketrew: The HTTP API</title></head><body><div class="container"><h1>Ketrew: The HTTP API</h1><div class="row">
<div class="col-md-3">
<h2>Contents</h2><ul><li><a href='#Examples'>Examples</a>
</li></ul><h2>Menu</h2><ul><li><a href='index.html'>Home</a></li><li><a href='Alternative_CLI_Application.html'>Alternative CLI Application</a></li><li><a href='Developer_Documentation.html'>Developer Documentation</a></li><li><a href='Glossary.html'>Glossary</a></li><li><a href='Long-Running_Plugins.html'>Long-Running Plugins</a></li><li><a href='Server_Commands.html'>Server Commands</a></li><li><a href='The_Configuration_File.html'>The Configuration File</a></li><li><a href='The_HTTP_API.html'>The HTTP API</a></li><li><a href='Workflow_Examples.html'>Workflow Examples</a></li><li><a href='dummy_plugin.html'>Plugin Example</a></li><li><a href='dummy_plugin_user.html'>Plugin-Usage Example</a></li><li><a href='integration.html'>Integration Test</a></li><li><a href='main.html'>Main Test</a></li><li><a href='preconfigured_main.html'>Preconfigured Main Example</a></li><li><a href='./api/index.html'>API Documentation</a></li><li>Documentation for <a href='./doc.0.0.0/index.html'>version 0.0.0</a></li><li>Documentation for <a href='./json_config/index.html'>“Full-PPX” branch</a></li><li>Repository <a href='https://github.com/hammerlab/ketrew'>at Github</a></li><li>Up: <a href='../index.html'>Software Projects</a></li></ul></div><div class="col-md-9"><h1 id="WhenKetrewRepliesonHTTP">When Ketrew Replies on HTTP</h1>

<h2 id="Examples">Examples</h2>

<p>Let&#39;s create a test environment, and source the resulting shell environment:</p>
<pre><code>./please.sh test-env
. _test_env/env.env</code></pre><p>Let&#39;s start the server:</p>
<pre><code>kdserver start</code></pre><p>You should be able to stop it with</p>
<pre><code>kdserver stop</code></pre><p>Let&#39;s add some targets to the database (c.f. <code>src/test/Workflow_Examples.ml</code>):</p>
<pre><code>kdtest two-py /tmp &quot;du -sh $HOME&quot; &quot;du -sh $PWD&quot;</code></pre><p>You can always browse with the client working like in standalone mode:</p>
<pre><code>kdclient interact</code></pre><p>Let&#39;s see the API itself, we use <code>curl</code>, and we <code>POST</code> messages to the <code>/api</code>
service:</p>
<pre><code>json=&#39;[&quot;V0&quot;, [ &quot;Get_targets&quot;, [] ] ]&#39;
curl -d &quot;$json&quot; -k &quot;$ktest_url/api?token=nekot&quot;</code></pre><pre class='goodresult'><code class='goodresult'>[ &quot;V0&quot;,
  [
    &quot;List_of_targets&quot;,
    [
      {
        &quot;tags&quot;: [ &quot;website&quot;, &quot;end-of-workflow&quot; ],
        &quot;log&quot;: [],
        &quot;history&quot;: [
          &quot;Finished&quot;,
...</code></pre>

<p>where:</p>
<ul><li>The variable <code>$ktest_url</code> is provided in <code>_test_env/env.env</code>.</li><li>The parameter <code>token</code> is an authentication token (the server reads the file
 <code>_test_env/test-authorized-tokens</code>, where there is an “easy token” <code>&quot;nekot&quot;</code>).</li><li>The <code>POST</code> data (<code>-d $json</code>) is the serialized up-message.  The available
 messages are defined in <code>src/atd/protocol_v0.atd</code> and tagged with a version.</li></ul>

<p>To find out how to give the right JSON to to the API, you may just check from
the top-level:</p>
<pre><span class="id">utop</span><span class="text">[</span><span class="numeric">0</span><span class="text">]&gt; </span><span class="kw1">#</span><span class="id">require</span><span class="text"> </span><span class="string">&quot;ketrew&quot;</span><span class="text">;;
</span><span class="id">utop</span><span class="text">[</span><span class="numeric">1</span><span class="text">]&gt; </span><span class="kw">module</span><span class="text"> </span><span class="kw2">K</span><span class="text"> = </span><span class="kw2">Ketrew_protocol</span><span class="text">.</span><span class="kw2">Up_message</span><span class="text">;;
</span><span class="kw">module</span><span class="text"> </span><span class="kw2">K</span><span class="text"> = </span><span class="kw2">Ketrew_protocol</span><span class="text">.</span><span class="kw2">Up_message</span><span class="text">
</span><span class="id">utop</span><span class="text">[</span><span class="numeric">2</span><span class="text">]&gt; </span><span class="kw2">K</span><span class="text">.</span><span class="id">serialize</span><span class="text">;;
- : </span><span class="kw2">K</span><span class="text">.</span><span class="id">t</span><span class="text"> -&gt; </span><span class="id">bytes</span><span class="text"> = &lt;</span><span class="kw">fun</span><span class="text">&gt;
</span><span class="id">utop</span><span class="text">[</span><span class="numeric">3</span><span class="text">]&gt; </span><span class="kw2">K</span><span class="text">.</span><span class="id">serialize</span><span class="text"> (`</span><span class="kw2">Get_targets</span><span class="text"> []);;
- : </span><span class="id">bytes</span><span class="text"> = </span><span class="string">&quot;[ \&quot;V0\&quot;, [ \&quot;Get_targets\&quot;, [] ] ]&quot;</span></pre></div></div></div></body><html>