<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=okxW
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
