<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=zkA8
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
