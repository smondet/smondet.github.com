<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=Z5gs
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
