<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=Q8Cl
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
