<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
mLtvH17m
=gthO
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
