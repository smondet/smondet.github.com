<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
qBtjgXFk
=ukcE
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
