<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=eHoD
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
