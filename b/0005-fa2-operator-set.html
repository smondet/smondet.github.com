<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=tQGA
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
