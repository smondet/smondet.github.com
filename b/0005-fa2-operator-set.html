<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=2FXg
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
