<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
uWMQGV7wKRhiH/oa3cPd27Tf5kh9EgjH74rqMO0=
=vLLq
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
