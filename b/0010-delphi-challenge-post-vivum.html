<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=JhSD
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
