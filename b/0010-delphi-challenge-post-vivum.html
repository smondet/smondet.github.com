<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=8Xyp
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
