<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMCAen43tIpoRL/0uwBW7FEyXEdUBVrTRz8+J+cezLHJ/e+rdDwsSvKrF/z
ZPNqLuKccYQX0hSIBCG7HL7hsauYngnfW/Bvei3S4SAPgQySa9ENiNHo5TnmYmd/
9P8ATEDIFZLdSLMKw5G/D9ccpxjj3tBbwRsu0dfOufrA0dq4OGYVILuQYs58FNEf
4I7Mft8pG7KniaA4dVo61wIyX1a3G/EQ22hf/yj0Klt37RLvJzqStSO9UBjHdjja
6F2oqNN3lJCVHKpvV+xLBdTK80qRaZ5dNfoStDSHgYVA97CWb+Hh9JGHTdNfHaNw
649KPDF1i+C89vtW1lnzGT+Xmh4I+O2khZopqrNYRB9vC+k3x/6s1awAQoMDAnrI
rORx1PKS1dulH0o7G7eHYpkj9fgKVw1kskP3JCnYrCBlFRFzyrg3hhvfny5mnMPt
3kTMYWcXBkkAKmzhRB0S21gCHCopSN5l8m64GcUf5xUuLdURlXPM659wNo23mD3g
M3yqMNRg0+HRq50P/r3SEasiJ3Llm0+/D6p7uTMTfFhM9YuSJXp08exPbzZtZpOb
Y7HyHHRJ5a0loXR6wN9Q2XwTisf6H6/9Y+cFqceP+q2Nm/dj6szN2nU4H02H99aq
mBlt32ijJuuWFcizUCWqdgrsH/SdjtCxx8Boq6giXKmWsBXdsT6diDrag5CdXefT
MhlLT0CRlq23yhi/Pupb6Cx960vm5lOrWfh6yajOokM3ZsADj534xzuvc/QsBUVt
sYUDv1CIJo2p+V+q9OSIx4DW3BH4jElUMNArTV/zABhBH9j6StZO9WJQo9UpCoYf
2tfWcRsMxPivTDjCRhPXIjCCA2PkKfkcP23Z+mpSOjGVAvoRvOU/KSUSWCKurJF9
8bBnvMLXhymuLCH7VlKkk9cno2RGAfZeI5Dm83u8kpZ1AXmqyLW3e3WotBsXJ2uP
aHRyWydGKZ0DP0HEwXUQQnN5FbkeHeDk1WYTU+wstgJ/7eXdbp11qtZOP6xeGwx9
56qcelErZBLoHG9uZH7C6/q+vRe3IVKwjQ6X3rxpdYf2t1gI6igrAUcL/eIwTZdY
NxsGxLamQ8UwR5gfJeNkKTQMKJyVnxFa0h12laf/PP3rEmvwGh/tAfLxZGdRax5M
kI6jSQL236wf13Ccv8PhO56qztSnW9QLQtz3wnLyY74XpK6KA9g8ueVja6rikX8+
AwZRxY5GNvmARBkswg+P/d8wWBA9XeRlYNX/lazt/ZQC5zCjMVo0Q+E0gunGvTJU
AeQTefCzaEWoQKDaQ9X07aI6wj49RERBdBoYo0NQQ/QgYhkGPVt9k9YsE71RC1eK
OBN+qT2EdmI1bd6QufOSHqMPEp3zUdPaDKKa3XG0/oefz8y09caLdfl1mPyLmf26
APgN5e1yXuQNfGjCraj5Q9TunqhV1YL89zP3z8oUgJ+6QeVecnJoqU0kYkpXzega
jsYDQfTFXRjxQigKqCzQfmW05PKJsZvO5slaBtVMV+4MYoLfMB1ly9oRIK612vtd
HEds+sad2gUOAI16cAFmg7iIU2cDVWMw11G5D/O3zGzODIUZlyJuYQ1h10mtFL29
MXZwggykEdhqX98fDMq8OIUDvNGWIAiYMQwDgdHGIcszd3LZbIS16vvoAe08Mbaq
uWDgTYgdmBRp2oS9FNS9JZhihfLm+VHvbdVgx3W6GZKSjqyRKCTieFcNTQZe0jnF
t7PTiH9FezjvnRFJZdHcgbxlcX8DrVigAvV0x4WOsaAYXsawukmfYRq5yVIjSAma
BExvydC4OdXOitRIAGIOireW3zVedD+lNE5taYt+x35DKPdFQa5T1E0IywDqOaDx
eRuLkiAOVZJejWyfaGb1DGLhxXPx9CrY3DkfO7mB0GjHriuZIlku+diX0HM+e9tX
fgvYTtdoF7iw5GhpbJuwGWMDRbkhuqNbGK3FjkaG6vJNT5o8hrItwpFTlqQMK0vR
4MFRULan/7Ng/BlDFUZdHtr4ENd1HYiJdRwqoZxgF3PbK2Q5NM9Mj6O+hRw66sFq
LxwxVHVP8MwqUnnMpyRn1c4FVy3QkjffUBdlNnnM0YuYU0Rp/Fq19nm/YtQ2FW0L
rAbMKMv9ahjH2fzDqXRA31t5XpX/R3cKNUq5Un/b1z+10ZNF7xCUZNlbx1qg+JNn
NcO3HZfhE+mX2D/qHybTuTh2qOyXtO7VkmzgmPm6i4eJLp6DgSuvkxPykkopsgTI
E7ar5QUlv6l5dE3/4G9ErL/QrUb8Xyy4kCBQLlFOadGWBXI8Ybloj9XO2oqu9fe7
Hu4l5rKVE2mh3Hk/QgFi9GVWmmCKWRY+XVVVVrK5/dq5gWaKnEyBOeOZPNy5qnsA
VOVA9rovqhWV9CwozlALtiOs6YhR8WqD+TOJREhWo1ffU5xYOhd0ldXZFgCun7u0
6sF1JJhTk/i/RsBV+LvtwqPfMkQgQkWe3xwdhDNaxAZaPKNG+Uhpp+51xE792bBM
lGkGLiV2OGjIY95shV7nCOmkQZLuD1fD1gjG2OQ7x9tfoSHbZkCl58kOwJiTqRH2
Ye3/FKLU4Bm9eHlIpxcpwhR7V0jcrf+67P/vTvda9M+JdL6N0DnN475atgERvSc1
M5YDSw9OPUYcZgdZSn4ZHM/ewnCMwG4q+dnvJonTjvcne+x03UUReupCn+F5jXn3
52u67gAqzceJu0ty9CDiIppDASA8a5NQrtENgCWNivvUNzbXdyNPy+UmEs6wkgCp
oioIbCg2KgaAOdLMD9EujU9htsdZ7Eh+MN1e4uWNVB+nDut94lA67wV67lumXH1H
J6VCYNsytm2d3ygA9A6vQ5rkb76T0FrWuohF1oMDrnAiLAD6zK9suXw0jqSRq0RL
8LiYoRWZ/BkvKdZsFSxHRM7EnC3vBaa1xzqWV6Rgar4CYp9RB1m14wrPBh7ZqakM
OrmPEM386sbg9zXAbukM6G3IAtlwWDQdTB9ZKaeZmNuSvy6vlG8IirW8W8NdHmMu
BdzgpxTVZcbshDzCrtPVCuWNkJwCC2z4Kn7zTuYjaH1vITlZKzAjO7HtpcPo6EMm
oZCysw5maZaGa7aiMFU1zXAFAHRxVt+XJhNpCpfkC7QaRaGe99PQDAHwxJmgwynN
i6v9x/LT0qQrxObepdNX7XYjNLhD+dBoKBxMClri7rNcYJStTVRqoiCb7bSGeycs
SRB8WHkj0eWT0PCY3S/ZeSCedPjGJdm+TAb3D38QnFR6DVr1CORryPUDPpb9ZAkd
IW38Xc5YxVRaLSFj2GWcvoo0wGMZjbXcEJ/wtHAG2rr4iVvrDjg/UoyewW2W2o7s
YIf2lj6Zspd9G9G3DUwp8RpCsrbqh9+NeU1+vqhlAlOLyXufOxmvMPvUD/2cpNYz
EgDmamBduf4UlgoMAXOIvaiRCPSLvQLvP8BqezG/XJplHaj1npcgTDicxmgo+JLs
NZQFltmk36/8K6MG+NIcHu/Q3zn+DzNMK7skgWLIWID5EKp1e10vrXVpXg7lhzTE
/YkAOft47GuL6Q/k4tBGgezs7GNGFmygUf/H8arekWDKG8luDHbq/ka+tB0fV2/z
j7gFxssYxyT2rkm3shreJR2l53r4Fka+Hw5mxiUZamCNIcZY1BPGSAiu0KCWGX7N
3kvc/Iz3kNpw4Gwfsr4zjZsjyBhTcVyGaf1X9gwN+1MCYV2fdsagOkn2eUTZJXVl
qHj4nkpFQwZs02XLhAAEDM1l3sgSGB9SN1UCJb4jBY8fo46eKYViKDHKtBmodpLl
JqBzZCCLcMvq1YEZfuEehGbBnoXXZhE/5B81qkNIiGFkOWp0OfbIgzwtN1C51QNL
MBej3oYadPjI/cUhVV1Wt2yGI7dsign4dWF5xWV9QxzYsXv2hh29DDT1ED9RYAom
s6cG9kxPJDBE5DhnLIsmryU0bTQgZqWIgJrOO7aS2lvNCxOPPOF07Od+70l//I6V
HYMyYk0L5/vNDiBIxNKKPRt0o3x9yLR85OIs28OkZAqUoW6Eki9lEtVJt9VKpr01
odFA7QEEjBXeWNTiM8Y3J2DvLoSOE28rl4wxgCEciuHO4ZRggJZiLV5nr6bilWq4
HuEAKznzlIC3/LMEhrZ7Q5YufJw/uRQGLemOHaqSUBWuC7FoL97yUcKe/aEhfTvt
9TsvdyxjdIduwRhOBeHKurmEgYA3Ts4DO8/ZbbcLz9ytRPbDS6EeBTbZ2VEhYj8p
hkMn3f2N/JCK0icE5v4SIj1yHgj/CXpUYan3PY6g6VUjG4/c6W2c5cjVk8CdE5fH
6fiknzJhPcnZDgmCDasADtrno+5mHfi8EKByo1i8oHQm3cOuwKgTqOjAL+zrXbV4
St7GJKKbzPGg1z9YNp6qoMPeahZ8h5EyuzFxBocMVg0pzFD2I7QJ1yN6lttjvv9E
AnMjydFg7JLmKWpKBBNMZlWf3MITeuvLDWlbMX3Nh4KneJXYP+9EZ/5QilE/+7dg
EkM7zi1FNkrLUEOy49RzHTrSgAsMX5QGUoznHJ9FY1lcxqneUF0m4OiiTr/B5c6Y
Ym3VKMrOqrPcHl+2OvcUZwFYBxnWL5Lujv4Z6PJ+4V0Bp5Nr2JUDSw0atEuae/xy
UpuHTPfuhNODi8imO9IMvS0E0OIETypgMittanmXCrWSm0ECP9QaZaa8v2KSbMEu
c2EJa7jhbF4izSbnGo4xaCaj+jXmrGTXP8J2F/j88xUX+uRK57Ak89ZEqJRaA9EJ
7549P3YlXH8hunzmyQqAQIRYyP8y25Nsg4YHMJXSFAcW2dCmQdh50SzZbVJM3uw3
RAnAzt/576KWQrKqfPQS/+0TwKYjQR6k0NnmE6o32xRCsdLqlSxqOga6MPpKSVLm
8vTuYHJkjFZGHtWljcmj4w89EuSfnpV1Dvp1KWmsAgbzoiTOEF8aVddo5RVxMb7W
5UPoodCZwEk3ovMR8YmIrm9OBXUA2No4HCHtuEZgr4oJBUSEsbQkQCk6cxLi7hKc
y9VyamSbHMwYA2SvDrOEh2+CwtKBIXGv2BLyxxkpu76gVsU9DJwPfXbTWCp5iB8+
cIyo/EYdjkt5ZMnMKEy8EJ2Gcf0yILdlfYcoziTsqjO1WmDPeT5ODbQuKOV2AFmS
aBJKtmNQGgrYH/olVv3HUKSy0abq9oegA51O/keug3QL6KVJl/1IuoZ3zixhzi72
YKwpfDDYHV/8cXIo/GSAS6WeWKpigo4+3VgM7g+FWWhER1yK4oAxpFipbZOY9q5C
oQglVG43aRQdFkG2AbR/FrtXvR4WSvBWjUQRyA7UTlPGbQYOxBB9BGSX6Fw4Cdbm
b6wpx4UAIWtIeQ9zMdJO5rPQuEhuayOONYwB4I+lBRyboAyY+G8PXtljIU74yEzy
OX9+pzPHfnSJ8fEVKCyEBjVFvlVAPSSNegiiV/+fRSrO1366PvHnTkgBomd/dbqi
6b/HHwhOBM6mRoER7qBTjty0CWMiaoURgXTWGNaRHlM+wDNfcMuq0JXoFWTGEW6q
7NG75HV+niBulj3Ikx4bUvDYv9NDfrf89vhb4CXUWTPQETsQdXZPSEyqLehuIHuX
1163RJB/HBSH04Te5qTtcS8Swc7FDgFd9zC46q4MP7cGK437oj/OhG/CnjK2+LVk
7nxKXuTPc9BM/15ANMeN/GEjQutITOe12OdYn0s5cv7sCxCaeTET5NxtLFTDAVi/
/HnBS2VKaWOy2OCeT1P47mfKo/Zuj+hqk7SZ/0rXY0Go484a9kcq5gegLBbqaxxg
+d5rKHuKLHQWWN7MkSZphP2a545NIqc6H6p0aLtvIM+EQakgK9Q=
=zw4m
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
