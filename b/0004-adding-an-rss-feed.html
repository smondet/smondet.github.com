<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
lwygyy1BM8FHTy9GhPnkTt2owH60eePrnvgUnVA=
=4FCp
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
