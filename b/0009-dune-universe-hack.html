<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
2mVuug==
=KW5g
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
