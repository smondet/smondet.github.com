<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
aW+Q
=91Wr
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
