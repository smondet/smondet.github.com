<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
SmK8K6++PBDV
=j19g
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
