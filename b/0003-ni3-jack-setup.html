<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
Vi5J/ONTdiLXVkm1
=+zry
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
