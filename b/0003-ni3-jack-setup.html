<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=fiZU
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
