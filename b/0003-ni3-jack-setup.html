<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
esHqUHI=
=QEE4
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
