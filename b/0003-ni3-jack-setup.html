<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=Va/Z
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
