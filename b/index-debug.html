<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
vxnBkZdTdIjmVXcG5efIenxojr2y3Lc7h4jd
=vUwr
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
