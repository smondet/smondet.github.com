<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
6g==
=NrRN
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
