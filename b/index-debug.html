<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
TjzcBe84
=Cdgf
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
