<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
e6kPn+RZOLIk
=veS4
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
