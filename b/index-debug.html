<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=mwzv
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
