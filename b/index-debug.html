<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=dEQI
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
