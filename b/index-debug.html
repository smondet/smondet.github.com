<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=+E4A
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
