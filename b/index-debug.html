<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
3YHWsTwnvayRVdZT2CXRz/bb4/FeAW45N09d
=JNh0
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
