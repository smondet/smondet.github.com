<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMCZNb3X52n+i3/0uoBT+XT93MKCsZX9uQNnXL9YidghjpgYjfKRR8WymXX
JlANQMZZ0JrfE3i7Q2pq6ZHtFeo6bKB+0kUVDLOaWwAEWFQ7JuVmI4l2RvTj0EUg
etfkHH/FFpBDsWx8vLDz1WiOHdjdglYRHTtMuQXxgjsokAg52G3XDihZPc/NSqGu
sIbslk8lETIKla3IERg3gY/UARJ9qmsdar8J5Ce47cUxykW17TBCgTPo18F6UIav
/pgnl3gruEMNiVkL9AsogNoEifLwm5m8iEqBol2Ymqx3mDasZh2gvHrf7pYNi9l+
x+SG+Ei0U4LvlIdSxy/e9xLovj+x8qlSHjdHd8WZmiJktzEGTu49pxtI+4l6CuIS
zZMX3YaB8uHYnivUBkJWteuAgv8Lf2sId2t5UumPc/wywjDJzheBetcKDwZon+gH
YZ5wiR2BiIawb5Qh+/oI4MDY9aCCbCyBPyVQq5yABCid9P65yige0V+8dGoyjumz
hVAlKGLJpPW+Dyd32GyciQ8yuBVXxa7HJhY+X63x4GTV3n1aeu/ufvkmapZsrxPb
2nMJcxq96aeyt0lDdCkTN0XU2wcbAe3dNhP6y/BOc0gk4oSRpThMw95swd/DO9DT
xk5CCOPvu8evjcVu84jzREEVqn+IP95T7QxJnCusjdZTpIfBh59YdG5xGSJmme9e
lCyhQBRH56cqJ25lZpzvqVZ5PvWX+bZm+kIpqHPHNFie4c7Y7cVSwrEibmgCujEW
g1qXguLBHmHaZffzHA4zYrAUkOsmJSPKAZqLDy1gg24wob4r/Suz5mTZhBIooM4b
fDixEVODzBtndsi9wzTQI+ttkA3p8bLQa+Izi8hadnX5p8+NZDI+bpY0cxLYo0Ln
GhblKUeqiqkChJe2KS1CYETj4Io6v8dEALkGJya7mTpti2u5HdN+/XA+LclFiwO4
BOFeL8q8Wg6wYMsSXOwIro3Qbjp43k2KLi7nhXt8o09ncAaJ6tdAb3fWxuq9YQ4Q
v7JlWDhcfKjptwNpU80cqjBgGo0cBOPcLOzKr1fzARKS/5w4c49fu9GHawA1mn4t
mJKQ4MyxvrJQ9zJh7oELZc+z9GZ/k31X2rK7unaAf1Cj8ne3xN/jnhlSDHj6tiM4
HX2KWuiF/vlNKxeJzLuzhlFyP6DiT2m1i9oP1u30+ef7756OCaIu5o4oWEmtiq0X
R8h3a/d0UpplLxp7GhyStuDGKPCBFobcnwzq5ZpRPWscQUrUE9Ft65eZWIYrY6QO
MgmCcvwdiHGnLDAz+MSEAuvfXUH1y6wAEms3qBIS+CMzlpTsdMMCi3X3IprrP2YC
8Yf4rR5VYXepRDv7V08egWouruoUCL6kpbFBbKoWV4bv6RjecJStEjsM0gzex6p2
9RI8bm/pTiumqjEFBh2ZQRm5QjHORwVyB7RXGsFfr2AHyd9kURMXmf1knRR1gIkI
5AQfYW8b6k61wU4WOlDV1yxYzwVBk72YCUBCU9VH10S51Xm6gCs3K8HGy9Q5ObMM
uIRf29hG8EgcPBzu1A5suuI3WCI6qfANZlP6wtBvtRTAFhpd+AvQIZP21YyuERQs
nnkb4clJtrEU2/CbXoq5wSwDasJK1RnFXL5eiP70aQ/FTPlw0h93DNxq3qRsTzCk
o0w7WWaqt0Zyj1qryFDH2R1CRKq/e6FjS4EDTNvHFajFZ9jCox84FO7x8vzllq2h
wNR2tIe6xL1+SgX4rUiPgyXX+fzriVATJUDlkffOgWl7fxF8skDuFD9ZicU6B0VC
7GjdQzzjp0cPcLErA/wsm06V3hKDAOfGBIv2+1aMVv3AEka4vb02fZ3jsXYna6Wa
BoJZxiU9u/sMRJwp1lUY71ijRBMCnzcNZfJczSnLZeZzD3GVBfQzafXQMhknlO1N
Dh6s8kXKko4+WTYXtmv8XShPuRldNj1x9d9LDxO7TNaC/QjfPeTrmxyv/XHKClC3
39NaBQ8zOrVCY5wgukTSlNXPJLnpT+xLFQBDYEE9gLIGMldGOr+F3BjXV4sjWsn+
1MzXewBH0tpwmj8RASf69h3vwM7nz+RHdDIUrGdmRdAs1ijSHxLoybGgf3ydZ0OO
Q0PBsw1RiyRX3aKTSvfv1YIdUKCtmKe4BUgoK3tlcTfHvczT7u8CkOL76llqDdTe
RPvwC1VXiavpVv6ddd+Bobk3tlmvPlbSdC2lMnlo96aiqa4MJuoGcjRzC7iL6J6R
30+WvjheOAosw5mXWeN8sMxRdmWSu7a5R+SRZSxGU3ZQ8f7cQogEDY7Omjha9GlZ
CjnHNgL75VeRkBP/vgWeeFH2an5sEXvIWBQu4enlvtRv9p9UeVCE8It8/soSjmfe
V00+EF2k+X8us4VbSLjQIKKhy5hQlr9XlPkFjwEcNP/Nt5jgDGCs9ZloJ/n2Er6J
ZNcfZ0cmYhUg8NOopB/GWS8bIXmMvoz8adPPJwIAgqk87eguZXeevvK8LHNcLyRC
Px7MYgrwzqZlgsyMteEYLa1ib2NUDIXz2AFZ5qHm8bdVXPbNw+o4bZSiJOZF0WlH
ngAtAndj0lRl760+0hY2klqu4tPyuLoc1yuzcr2KGvcv6g==
=fGpn
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
