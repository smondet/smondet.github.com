<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=zJUz
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
