<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
lHrbWdEO4wlpxvHcdUjaXKwHfO3LAuKAqKNM
=J9zx
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
