<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
lTzq
=5vS9
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
