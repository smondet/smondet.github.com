<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
4PrxMWsIpgvYS+zuQeqUztlVPTxhXw==
=FOdp
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
