<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
pEG/DQ==
=73IA
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
