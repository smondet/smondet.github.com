<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
463cgxVww/dn+h04+RnX
=hB6X
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
