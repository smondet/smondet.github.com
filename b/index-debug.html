<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=eVsM
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
