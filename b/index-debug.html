<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
zZZ6smNx5l5+OY1W58Q=
=+8W4
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
