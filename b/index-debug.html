<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
cxfqIjj6bAw55fONX9+tRTd30R2temHk5A==
=D3QC
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
