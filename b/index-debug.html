<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=4VFL
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
