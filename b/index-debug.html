<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
gvt0ITp0Z8SFEw==
=z8sm
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
