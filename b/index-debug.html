<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=Josg
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
