<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=2XuX
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
