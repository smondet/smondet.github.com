<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=0ATS
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
