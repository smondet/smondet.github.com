<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=1ccg
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
