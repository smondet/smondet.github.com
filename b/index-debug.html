<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMCDT55XvRK4P3/0usBonYi7rqSZHBNKDUF2oohI97V628Kcq06couacfLP
KkGG2xetJQr9wwyb7bMjMEDujKPq/Wqx682rre6x/9EQ67t/D7oAOkzrSa65uSor
UtI7kSIm42P/0jr8ASz9S9r1HDLkEdlqvlTtzmIRDchpaXPxtqydYKJ5mpBLXyoz
eUZn1xN4SJJ3Y2QKeLncCbNox8c0b09SXleIylicfIqVMdeJ3jvWSIC/hoSZeVsO
1bWQEK81T5ofzAKVjNBJ0aNhW0ddsUKAxPtRNISL0bo9WMKWVFIIVsNET805skI4
XtgdETgzcniQyOBSGJVVNdghpAZ5umhGY9kOc1d3ZiUvzd+SpAkSxS1nMshktI66
vPjaKCasdcPonZcLDLO9YJWH4szjwbfajyh/0+nJl6hBH4Wy+aIvxrWOSBa9bZsq
/Oa1M69H0uZqAfQBSoNDPLGLWXrIMQgsaXFSWWPvitKpjEnLysdwDamqsFPZwSX1
di+ZzdlB2cA82MhE4atrKwhvVQC1WWZyBgoZ4iatL2O1UvJyQjIENAw8Su1cu/fU
GBEJZarDaQWeaE/AmnW3WRH6khHogsenK4+I3dfoH4qDnG3p+TDPOh8Qki1BM/sr
uw5klypmcDQ0cPtEX78XlPb+nE5DN/ZT7Tgtg77JuHU2eYtHMwVX53pEg3U+Tg7D
sxdQBfhcq+ed6MlflmdNjvLz24nXfNyWKqDRDm25njHPN45NHlWHrEghftYiJIR7
25QQn5AaA4fu6iNHqRvH7tHVG3pybN6zF2hnIunC0rRJoocIoF8NBYAzz31Ve+uo
PCPawgeAOnyrL4XcEA1SkloJ/iVVselLBg6lThvAbPDpsRT/bm9Uz/bkiix6n101
ibo2jndopHqku0l7BU4PiY1HPmIf3yWfPhgbYM0Um15qv0XhZGcs6CTilDpufgZq
I3RMdEzGCzFKcRb6tZROp1WqFuIKmIfp5AQQ6jwWEp2e4lQ10WqgiD627HIuvnB7
JP9WuG2J9hNpvScvh2z2aF/sTI+dV1Xc8eQFZdQNS4MrhAromTffkrsNyFwC64bL
7Zwrae0Pa0ZA23Au/xrV7lR3RE0+c5AIKlUCMn4wj8dQEGCqMglm3tuGG1T82J2X
2Qie7qaRnHXEV4JGd/DE9XiO6SXp57k8flZ6ZVj1tUCxjqgyPrYRqad3q2W/OfIc
Pzm/F7FrJygquH2re344KFWjiHtwjJQ4tVI1xLvW+UmDzrsnyCvpZSwYG42CIWzH
owG5h0o+XHjPBF6RpP3aZkQ1+LqBzVIYEb77LFnS2WqgkkWlcfxmVONhWY9qki8X
P3zCaMK51WzOzLVQj5E8di3hzDkfGlgD9MKS2DBVmdYoPZSO9ybS/1PgPcM1wNjJ
B449agZCgFDo0YQyxB3WIi9vWK7MHJsjoZUG2LBhfmHRcO13Xh2SN8SKPf5Blw2b
5AlGjlK8rhcTTMp+/mcBXknM9o+HFgHm+LcrtqHyDKiyC596+qC8d9GInYwZKst5
DpcJZfpQVW6oHOqYofOfdHzntOA17kcghppxB9pM49nSNgfa3+eNChunlZZwvhiM
ijQ+gubaK1S4pMflw+M/wuT3J6A6bZopX81Nb/5IJ2ascwTqQ2iZqNpjkBnFoKYt
rbli4ozlKrNYF6Vw8GiL0o1D4YA8Q3jOz4ZlEerMIJcD+gjhnw2URmR7nbOp0+Dn
KN5y8oKTon5Z4qsuUF91teV78ZQNVmmGSLEbIhW4rnX9q2n75fTDbPyKJaDQM7fM
Mqj9VLN5ZiHflzTNxEB5qi5S6AoybaF8ob4NMILC398pjWz0H5SeD3aALLEMYP8d
MeBbovtzjt9vmDikxKqmvhXMYNcIZ3PftWXTqsNOMFseXMd5/jHdlxelUHTeL91A
ydyRSOZ3eRBqAYZv6Dlw4yetnxFBCltuNe8MfqedIM2mpuKkhisaSY0bPQ0stQSK
RgNvqv75tpTOMH/FKDvSUlaAsW/Gv3Ha0tt1FxRhWeF+XLKOW/X8U/+Ke6rxZ99w
126aSJla7yCpheacRQ5/Oml/vkPVd45hei9NQWns0RK0Wd0+8vOqJ4HbRNvsWetV
TzvgKmKnd/wBPB4bpYFPnI6wx3lt/SPQiOYgCHytEX46NxLyKkzALestsMHy1NKn
7jVLI0uLQPXCsdzVMMYePEPx9QC8g1Z+W7pQD3uGEKsFcDNhIEWaG0FON6Fxpmdx
8gu8B+QghksREkptq7rWHWozXX83qBJsahoXST3nhQJN4hxXNi4Ke/FUvUXBz9vF
hwU/K2FiVO/olC2ipw/kKdFqPwqo6cMhbMqThtobBWl4Xj5PimO+cQ9nDEp7L5Ts
X3i1Eua1zpktGc43kWuJg6MK0+zCHH8jhERQ2IKRv65tH483AdKsl2/Z0UhWjjRQ
RnEzi/5s+xPnGH8p/bjN/ChtNfYVRDnUjeyUI9erhBhuM/MB7SfkLrxW6NslThz1
b2rcEXHllbATCHQ3Kq1p0hZzEsiT0ba9ozQl0EI861nzI16UltuOUqRjKGovW76a
10vDtCqz0sekJ9bF1g0AG0TgiOUx7anJ+EpdnylcYLCoq5dv+c658aOQHr9I5wrh
MCfEt8CU+7X+v8qEm1Fas0BUD66h+6KbqPTg/soP8O4zeJ0gS+O/qOaOdJlEoglv
QvrwoUOP7F6sLTIxLUX94UOJe7f5g3XMbqaOryfEStciTWPLKl46ztL6i+HY0TI5
O+lBD9i4Fwv4cyNbgk2A9PqSidhdahOh43kInDLA6Hr4/9OA6dQez3KcwDoyfLsy
o93HYlV8XKioMZURvJEaL4LxjRk8/UQmhYxkQ6f67A2LVRcXu50WkKvaKrcG4hN3
AlaQGccfGggPRmvz/0WAs9K4wmgSdhdozDnblKIeggbZh4ef8V6xpFSXPnAb9ijU
C7xsIJpu/ns2tFg5OdFPQBa2DTL9AfMcQh38VQLFQ1PYkzM6Iiz1zbJAmgZq8aMF
G1mF39qZNKAJ7rNeCg66JzqH6aazUNOp+0Zg5qwnE7T2eH8K83MlSj4f4308FLTD
vA08lSWLt9ybERbIXWAM1daE3xQ445hJqrsG4ZczUUxrg3jbJZlxNiGv+cPg1ThU
j+ONJHJVs0ewLOJfMmj/3i3PH34KIG8/EYNOOrsLaA2SvLMh2UkLvF/zvpYXIx1D
b/L/XlktBjm1GQsKf15G5Q+oQg+3ud0140MWjd0zdCn77bTrrFqnjKiI90gv8wle
fNA3MUSwTfw/eEQZ0AchyIv4FDFyyLV2+VGgrnzhX9OuqWP7ouKCJhTD38qC0i7D
KEYn5gLiB/jwYTUpUEK/dc4dKeXxAwfe0TxwcoP93e2qpf9MNs+BiP5mgJ87IjO7
z21piEEDRxberEzU7ZjWEe37VhmiaU2IvGDZd2DWmtHRR8DHgrS4iaujwShk7rUp
HpYNiZHM6FVwzxoLT9cgqltQWkTqztBK9OfuoAjOi5104IR4pFxDCUtC6BuTRNmJ
F/Ub2nST27zLHug+lCt6TzT88lEXNw584lRQWx6HtpBf2zVQaBpC6M29iKIvivyK
teORXWN4hhxyHVDJG7ph8d8uHenHN0IllQGYEbTWB/DRRVQrEySlpu759JuGfp4X
u/oD+xEyQtdMnY2qt0V6dwT496eiHBlMT2FNH/TN3FaXxxkmcku3txLqTtHmDO+A
T0U8fQ0GQfSJx2XH0SYTm0rYRg6C98Ir4CEvXKImIY7vvW3gvk6gDpmZ+R7zkpRe
AHegrjKiNj7BqAgqP9bzJpmV+qNLTurBDokzxmIpKVI3yEvpuM8AXDWnigC50jkk
CiCHT5OJrm4jVxDydnMpk0V4Jw7raIqpEbhnkqY/T5NeH583XcCkAmvHIKu61c1N
Joj/Kkh0Nz66nparurJUNVvLKdiiT2ikllbRPwuDiZKNIGmwPpHhSNEhkQ==
=rye2
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
