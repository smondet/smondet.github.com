<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=TzGr
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
