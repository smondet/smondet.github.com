<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=ubSG
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
