<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=LbvD
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
