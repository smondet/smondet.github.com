<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMCyOXsBhSGdub/0usBQSdqLQZXFlRE2DbDanDsz61+0kLxDJwHujfzaofn
6N+zkvisXwCYbQ0kZHD2QYn/96WwKMk5NhdEmI1P9axoecWUAAyfWJOHdUM2ANgD
y3KIFAck3WfC3THt/LJ5CnzewPdgRPHmpr/YpwRGMmmtloCyYZ+OHKCJhle25v73
KGMVnRlwkgkngJuxRZLT5dp5F5mR699t0chgnAt2/ab7JqiXRpNS3zEnnE777j6u
fP9dpB2ePaDNUfhC3tqRmnMFokbwYo+eaSafRjpDFNGPhgq0Bsd2DsMV+iOf8LR/
y+Xx9h1mpCYuLuQUQrZeCt/vB46G0wQ25ltI19WlC8v2MXY9jnSYBGk1ZtWkAvjK
iY1aQOhHYYLmtLdeCmA7i0TOJQ08mjhK36Cw2nw64nQkMNokOzNEIUjdk1sbYIGG
s+t0A7YJ8e7WPPDqv5qlMjEkkB6F105FlvYi314jlwQouFwPKA1jy2sXF45Y0i36
xazyOIF49B7qpGam0TEFa4fnMfbBuhOyTSTFG7sxXTA3WA0ro0jHCsk49X1NBEPO
VZxu9ndYj/fDT9WExhfZPt++G67QAHN9E1lgHXmZfRgJsbU+z081mDNqEe/VWePI
wzFUn4KndoALlPUpkU3zdXe9sF5sLGVww5qdMJXVx+Dxq5HcL8HEK3LgS6ZO5SA0
kLQIJFugZu5YkTMA3FtW+fi8OGX2/Yhky3vN0a8yCqL9pF/msxoN3YOWH/kqkc6K
gdbSVQcZKtpCW4T3oM/3gez6eyjDQ/Gu3vLSqKKORdzd09S9mrW2RE0HGP42ro0A
oU/IBXQdllIoVcPK78fmHg/bTshduFos91kFfMxv8bigWVXeQDyZu0W3tJtttCTh
hhNeY5aZHe215L/sSEiMlKo5KXPdgIot+mltIf7icBHIovPhfopx5Ej8pTSwaEEG
Q+OG/nMcDthQ/3sudUOKMzfdRuDu/cOaBN09UJH4rygKjXNtkFpZUk7TFpjSMUo6
soWrDYli+kX5EhKi4xFaRMkHciN3Hchh78YFj6K7D5MmWNz4j60RQG/9uhzP567i
X+HjCykFeg7LnTiSA6g9Q9+/f9V53NLKBKS8EvwLUg/765IJucbsyxtf/yXuszil
fZf0S3x8tzZ3e0e5lFDD6Y8rfOFtjyIdJpYGNo5teTM7VzYDHhWRQRdEebZGCysg
jMq4ujjly7DcUatioVZQYLS8Fq6kYRxVg0PWq6reX/L1/Anjm7Ts9CxYwXp0vgSf
3H17E8xuJjf5GOs5tQWoSFleB2M298ZA/anlBDGJPu7PCXX7Fr9Nmx1ompCZG+B/
kX5y5mval27VzyR/uT3tUbFzm+8USowJExVvDcqddH+0S7p2YM/YAKp9fdnF5+kL
H3OzQRU/1rfT5N5ZBlKss2uEBMtsZ3c/RpC33/RI0PISoeSKjUgCAEyKWRwFUkLm
Ok3j9hps8f2RbezMuozQ8DcTfo7lb3uBpN9EZGDn9vkoy1cGB+D8h/Vu1m1XTrHx
u0LE8TVmxFnhf4Un+UWdFS6RDzq0YCp1cLp1n0gY0nBlPy/3hscs7pCPD1Nqv2St
y5zpSc4QC0cJ9fyAvSYcZ985RPY4E4dtpENpx5rcYtnEy1ZIfRg5/2mgaaIbK1qT
4Y0Aihdj9hkNMDXDJLQaePvUtE2IQhVJ2OSRC7HgKB2AXCZ98Xfzt9LePZdLdsJh
ej2dQ60XZnaNETL+BbnDGH1w+/K0APIbXQWOktbBaMVK96iLqeZEtoSSn99Gs8Mh
WdMN3mPbgsYd7E2Wwy+QbkGiibZDuP3xTDZ7NRyRD9eF91tnfnSq4IUWYZNprQ9c
awmN1ZyiB223kRZFwupQTdS/mDh9DyvF/u2k2T/DyTRM9N4EVFM54uiIWXvLFVfn
OGvjOft8qmmaKm992BAbExfompgs2xSepUaJGroygT9FhvMdyP8S596WhG+55e7i
bUh+vxQ5aeqy7F6KafmV9FiVfQwDYDFeSW5n/IRlHqeyGrmS8XdsusyBWbnWgTz6
IlU8BDwBLWKYsq5jiiGPw5m3Ox0YwSfIuEsgNAXftsZY2GlICSDW7BVxLqxp1110
8/n9g5KtLf3nrHPefFuebnZdTna6D+sUqeKlyZACcNypIXjL1gimODe5N5bEvByg
cRQUJvOLExEMEQw8AbL2wdbot8oifMB8TeSY2ToPJvkUxLWywoWms44Umx1ZOTZb
p66xQXW/LJXYMr8cpQBaM+f8PtyLbZq73HWk3D/F106CZUMYx8mky5+ekWOqIod8
ZCc+9C3Dbv9mmPAB8IdfaJ0f9qY5rrQNVmN9BSUCGWvsOY8nAQ88lLIcYNVdhKB2
SIICvAPG0m1joaPizB45l7d3ht7lQPPt5MzM1TEUpiSmtiX0c700PPA1RCA9M9cR
o4vSAQFQ68XvaevPnFrmocLSOw1RF3eVeYN/o8viYTv1fSuzVSpajY8gX/7ZnEAT
ojsVOzUbW1kYIs5qLSWGsaZvCpJZlpq34f27aD+/DuO4TywD5bHbUzEDHnECmVGr
Ru6yjZvc/aT8xjovdDUqqq752VUeVJ8rycIsLjWdopao3GFSgatxotHkzTAOZzzz
Su9rk9Mn05vEZ4cDtc8aXVhi2Tqb4ATzYYJ/Rw17vmZjNnePzBMWpD4QuknvcB8S
Mv+5/sNUUAGFpLH36Uc2kPuKCSvoZz5Iy2L2ENB7QJ76rB8/gELvicnmBEMsUvOA
RMEQYqEbIqfABmgJ7ijrvyUuNCkA+alb9Ox2PiMxEl5oOGb1gss/fKriSviHgJWU
z2BkC8W1Y76culCtLr2V85Yus8K3dBQXtN+X7LP5IlJ4LKRwIdCtzOk7civuaRXs
k6MN1qwfQAQv6Qr/J4xzD5NGWafsNq82m9Mv97gGG1GYh/VvO9n3XQDHCp6owvKM
WrQjcCYrGsx9DNH2Z5+u6E8gqDE9kXuOB+qsjY0KsIuFdAKajqD0XFev2O90aysI
nIbsedcWzSLGmqOxAlQYsj6/FMsjaobr8lyU+YStG+F+9yBXmMPLgCToKMdox2mU
WfOtASSBEQDtu27udYPjaA2YEspqsKIYiJNqyiSuS4iWc1S4BOMu866bvF0HYZdf
52DZp3vWiEl3PKAdYKX9hrmZGMPjT1T9iairzZr09DzCpDRBVBMuCBdR8LiapKPW
y/a48odwegzl5USUVZQH9RBcPMBu4bBj3SoQas8VJhL80GdcukDmVGXKiL+1pRO1
AWVAMbaKP5P8XNuf40uTNBlTjahOoHju2SRSrU5dDJDhsaDeIlBopEKJVr+iCQF4
6zORvBxvmdARNa5UG1VnE9r1WIWVR0AoBrfEg5XRlSAvoVE=
=DPTp
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
