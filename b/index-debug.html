<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
QHNSMi3eA0vl
=S78T
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
