<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=14Oh
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
