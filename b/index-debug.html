<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=kg5S
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
