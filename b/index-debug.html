<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=c3tK
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
