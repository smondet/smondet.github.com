<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMCl6NSeEnoskX/0uoB7k3zy2URL45BHBw9gFTli5Yk/pc7HAONV22qQig7
7fAFopawUCNveiMMhGFnUVcbwU/bzXNPwZ/hULLWLeubjFvR8Sz0VkRDE/rW8Dwp
s5jyjNCKCTc8H/2eUDCvyFrypzbO7nYn+UyJBqkwt726VWw0MtZjwcearkiqDAOo
nR+iZK2sEdwBD2x6TlWV8QkBroai92mEtzg3fsKTgsYzxyIXlhpDrXESg1q7XNIm
GGNmzLdZ457ZKPM0SZBq8IYf2rhYXQKXylpEne8anwXPaeEC+P3D/VCHpERJZyn6
/IJf1mWaK+MeO1uPUnTmXoHEuh9vVaZtxGchwYi7LT0lsdP+Kahf9gHTSfUza4RD
3Z/rnnQ1+AcbICS+nO6HckV/Q3bv3MwIvDJFR9wT9ay3yLEf1uDI/23vop8wqwIE
Gxu/OgHcIb5K7eQT3VsZjrBf5kEqIG+bZcX4Jzy2QoW4rVmmYVVv1Lgs6ofD9SCQ
ZywzrB07sTfCCwW9R7weXxu46xnBbkgtNyRVesEQfexl8jMkkxU1ugyvcao+4mRy
sre1DYcF7ZSKesb7TAQBgCNi2wE/IRX0z2pNiEhBwTle33gPUl9I8+2vmecvVGAJ
+KCKm3ay6lu/yvc6C4s56fdutPfUGU/gEr8DWTjG8V9Qs1FjYAzbgUWASa+4XZvE
PfNe2zzAq9/fl6QqXR6wSUX7BY2L094dmBym6T6EPn3oUDFxDD6gqzxKm7B0ytHc
NEQlRnyx9ZTijtrE2VUbdPs4r593rOGGinqLt4bo1mnFuLHRHhXr4xxs2aQ6YPkJ
Wo/hdguseeWiCthVhD3jjy7GHh5hebPcm2A5H7YdDAohXwTECrlBGvGvkztUOI91
cp2fpTAlRWyUCX4R79miB/itTT+qhz1+V67yg4iwhbblp7ooNJmw46FDcxUll8Pi
2T/Gr9AVIMLFR3gpkZCdpef93HfFVHZwD+BEVlDe7fMcm8RDGf2/LG5FySKgW4UL
xPAaxOUzG+mXXFA+FUI5fFiWoe6U2q8IdicckvaD4vhne10LplakKdqWxOsCLlTV
Ql8ulZtfdRC2kA5jO3ry6bMacWwHYZI/NgB5TBpgG9a/fXmOzdCDnQBBpRBxpL0u
CuzfbTEWVk1raWt6yA7wbzthWuZIIVT09hf/jGkMIwd96jAuIPxQzWdOo2iE/7N+
Zv22lTytQE7PebakuoEjJYDQS6m+946XK+cuvh9JYyd328rI8D9EEL28/WyeGfkQ
3Z3iRQc9pDJ+gHow4kEJ76UHFIUYs+TDfG8dMXaxQnCMnu4Sus4xfNj/ULJVHHXD
0FPne2Dw2qlGIENuWrto4CkEpUStjE0cNiDzsuifo+xc6eeOfNVGUuD9aMd/z5CA
0oQojEm8yrnNVPrx2Llh2eHF5kGFimh1tL4A70PzukQy6aJDrbTJcvI9aiXf3dTJ
DncKvGwKReoTUPkcr4a8B8gEod81X89VDzV1WjLxoVYN8K2UcbbwhFTA3QCfwuNB
iV9S+jonWeemkPekrGDlOSRGP/HSx5Nayj2TkrJBVla0TBoaL1i/bqxpfrFy/oDD
SREksZOtC8ZeZYUub5zzurx3Q7I2CNQ9XLNtI27plZop2DIOmYtdyWkrvXkJpzUO
RV7f/iRyqFisE4mA4kXRAQweBIvvKzIbWFDNij6Rq+RJ/Ki/CgKfiU3iSQjr7PjA
tM1rKqI5ah7KoE1mcRmK5ZbA/g54wxlmwQ/+Z9AaUU6gCFVtoBpAI/Ap8i6p222U
kpmWeYe/PbG/7yv1ujG8Myqf3LcjeIx6cc06WBNKfIR9Zj88PcRkUnuNwGTuxJ1x
sX4YB9mvphpHjtR1WZtLD0+FQpEK4s+t/TYxeViNhBX8M+XO1N4yfDveOyrp5zO1
5Uesi+Cu/UfCEucuo/Sfd6+Yx4oZY7v6ff5rbnkZ3cyNAyUwR8EaU5NAIwva4eVL
s6J6QEb9pLnnz0cV5puBLK0O3AtQtfrmisGiX+GFHJCc2KKUxHZe1jPknNraWFpv
kZzeAF+IJg1yQgm3GKQJseyTwH1LzQnJe1qwkSLQlfnPmCkcEXnR2u9LLv2UG2Uk
Blu3aJDp9a5Lpn49JcKbE4tn8fIjKmAjZokYRSn9PmYDxcQP60VCXDzuBLFQQC4z
XCb+bWsenEzcWP+jjY/O2955vZua/eKnER2cms6HQVmb8FTk6bmcCpLCOCAdTGie
+GhEDlVa8seD/kLntar4P1d8b/vlVa47pb+ym0VTOAG0nR8jeHkdQw2O2496Jm34
lNAaFPmZ1PDwE7uOC40R1p3/a+wtjILFNi5RIZbqlxMcCEPn7UNaoUog28/OERv6
Lx5RpapDlkru3xFF6RiWpWwHBpe5PCZRMMPXwmy6jKsgqAp6V+klQUSMBYk2Yccv
W2XokUBbS0C89gthrbqaDvR0QrRsJOE5apQbwRp544DghIAjmiboPJ31hU2Q+fkQ
YQ==
=hzdt
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
