<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=9rBN
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
