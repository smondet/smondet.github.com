<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMCpVgWS47dl7v/0usBVxKSphFWnqTIYSsKsemUZ7YSX5nn434sTb7/IOuz
VbpqUFCTeGlWR7qqCNwv/BJgf5XuF8yy8nH8fz/7qLBVy2FHNCwhaW1awucSDPJ+
gAg07y3HWtsdnBk39SCf8f0jQuIYuc45laS92rXU7ne/xGhLkQ+0Ru4zLHsdEf3z
iVCA25EZPKa9vexnMb9eVK/eoLPf8BF9Xi4C+wt8l/FY6R93OuMOtNLB6CLEnxmB
xW3IbfBWQtTh75R/u9Iw0NfhTxVLR6Vv3Uwd76YBH1c+we5iu3oKTTgiZrcIYqLW
XuqNYhhw+lNOevxVVI1RajQXPxi8jLx573o8XmAqkzYO9AG1Rd5tXeT1ZCbPMYC0
KrjNRy+xhe3dMTbH9fT00qwV7zqDLoa3Fc6anSnRj+xkwNcl9CFNPZl2Z+okpev2
3gtMkjn7csv9vsmi5jZ5+TGSRpG2qlTqGtOOTCIOtyJO+c9PJ3hMXII7FKvO0r/i
EJXe1mY38ehmuoo6XAlhxEq86B2eqN1ML8RRl80hBBCYobbnK44EvlSmypmME0Dh
0toiT73VQbufla5f2LnXWt0L/wUbi16BaoN5K0ai3QjTWAtxp/tqYP7GKLiq2tJK
PlJAcjcHHTGH1KvMNDHXE1E/GZdXNvaY73tial5+n80fTB1BDpThhg0zsRpll3c0
XGoXvKqO/Fkp40zek0C5fxkNa78j4mV8cxOl14/ympwnfQdrShYzrNVdhdm/ylOS
SpVi5TozwqDuPc1CxwQorGoxlXm/tl4aPT6PgwQ0qusMk+yRDOu4gAMEgNBXtWEk
83pEXua1DuC+F/Vp4FYFi98OIkebIQHzId12xo0WheSlkf7n+dA6TO9fAXon14wp
AdLp/+JNmUmIl5yMyWy+hB/J2UY6ckk7a5vaKrO+HRyBUDI2PxaED/iGUq4vz9iI
7qslQjY5PdY+B+wspHhcw0TbifwfV45bjXHUSUlOwyCKT3W3LUpHnNWrpUVgivpf
EAl6Io4/JMbL1loRbBnxi/wd45HQSc00/fqTiexSFMZ3VP835w54B3BXMdBs+MjI
YZX6JetLtveL5DEl7I5mn/jKST3ejO5DoMH034Kz6egPGwNAORjjQar+mgxWpPNS
eHhOKyv0+RqgMJDRa3lUKhtOnZW9VltwiL+xp24HfWqaLH+HvG+iSyVgEVwcg0xj
jeFnDqy//J7mijLxzdoZuF13SjBgTs7JznaQCWEnpU4uBOIpgO3iltn8tbSQn+nO
XR78kfTFjqQOFyX3aD3+YoGV5zsaKUyjPGIWeoJVfrpZmt6MUxHQAz0CVNVMYnco
VL3f8US4O20p/ilgXurGx77zk0km+tJ/s/DSoY+U5dihqx9gCJvuz0RS4OEkYxOv
fmhkkX6pH3DoApsERiEwoBqyGYTCirz0nMT/SoYZoyM5ZMjV7pyR6LAMu/UIZlv+
+6hK9bvJ8G3cHScHhJdrRDFB7PWlZAyMkQuyQjl+Vcuy/QSbyQX55ci11tXinitO
7AmLRw3dDbYBgqx/f2D9JHfXaXy1omCO6pk2lXm7CdTYpG8UiI4rrCADEuVM194Z
Ze6lBcWYh9J1ZZ8kZp9ft/b6dpJm1+F+0nHndXqgX1JQ/Hh3tDJ59UB+DJp3CSFX
kNiXCqoZai0CcM5TQ7BwYRv4usXO0ZGPE5i9LUwOz4yq57sclYOKGjz2xMeIHtI3
5fcFWrBpITuqSpwPcjsOQPUBshTbybY//9G/JnpASrEfE453mVeHcHxxXRd9dzv+
qPmxOyB8yABpyUuckZbukLrzsx838TIG6ZR9FeuynrU1D8wryZpYpa6m2GH7T29z
fr+DtCauuC/ls/tBZzW3dOZcUbs5TiPl513dWv01hHcz9ITTkduxUAJCWL2MuxAH
OefQEb+DmmC0ZPTgtN8+Tlb5zwfGoe0fp2PXz94YgOT+M+5x4qBBhd7ypG1StHwQ
AWVNsJyaew/KLhZ4qDdcxdYAyJyFfIAPBSqO6cqbln1E5GXFauOhSDeRFHT3pK8z
yAJCsTgolpBNcVhpgkcrW944nadA0EBEojUrON0RBABrAj1wsahBOXQI1MEne/4V
TlpvP5w+Re72IGP8CdHxuvfHfb8g8snWqaBfNatKbWhfniHWSzIFdqYUI2zonO+Y
20j4Mo0StJO6xDdA0QbDL0B/dhznCUhAAa1vX9aOoCNdy8/eGoxm9kYN7LOoYK3c
F/CpqGNEHsa/WdRKiOGLrwtgyYba9fKi+LVB+Vd7HryJXka8NQ6efs1Okn1Qa76q
PBHBkbDklxeifvqftZhR9ybbxCUFrPyaKMRtGx4vFWSEI4rhxBcfHPrsoyJQQOYr
XmLA6SED4fAevjf0MMRWtebz6EOIuJe4tOiNI+WiKz3zn3jtv72Rl6ddtPg9sfxC
kwggfFzdxqdTOaNI2y8cWEtF+Gy8+fmPWuo6etRjfq6vU+ew1U1fsLoTHfUIVRFs
1/Dm5tzLvkOCUKxxczI60X0dC0yvA8sv6mqlZVOKH9Rten1EEXN9a+V20KzxxHOq
MLLuLezYHHB/ox/Uy4jn52BOMj9wosLwMJFIWaubKf1GLXQWgy6HuwARgx16wdzB
2KPNirOXV2MUsEnv4WZG966zdJ27r5pWcI02PNNXns0n9qJFpWCpy7Hmj6dbjrQE
Utfl3kpFiDv9E1YluH/VB4dm+eSJRcA7V/9aXNKMD3/N1e7kwrTyQ6+FwVUw7gY9
EOm1cBmw4V0YAHjc4Dq0UeGuwccft/GbKj+3OyaREcUTaqQ4nEgVXbbELlW5TQYK
2ZKkSfFHDrB8aL8CYcaOlOU/fk8Tp0pUrublAVtpQwqW24QS/O/GcoP7DZuyNK2d
9RXPhPhzXd9TlFY5JRSQKC/uzNfyk80NJzKmKI3rdxHDkLlVZu9fXyTiWGiwUoOs
AkkVAU+VPG7atwINOTOSNYw8xDy+uxXhcKZfO0c6gnXuQcmrr+1o5DylzI7c8L3E
xWYCQO89cTsXVBzZMZV5sR+9NksFSBSetvXzoNUPYyTc/VW9lO1hklrdwtnM9UGE
ep/4B9/v3atPweAXl4CI8I/FWiL/nOQ2R6DIOpg5/mOC0dfiQKxrSOEZ60f7aAsx
K/qRa++JdFAqZdbdOdwBfhzvrwW6JigK+rQEji+h+G9aZkwGokqOg8CL7Pnx5bco
LQMBz9gfPvzQxSkVaBaFrmgbEmG4SOdrK5Yrw6n8FF/ORXz0jt1CkDHzUL++t4fL
NcRcSg32jIIRxSlI7xk4erAvnCAijldOoIPSbIXiewBgaI6PQmO0AN+zRzNbWPbg
Z3OFKeJCPZ75TOSLiPsYmPNwv6EmUPWk6cyoL48AMFdJr61ZCVAhX8cM6G0yQ/bD
GmLjlemTjtyC5c/fGIx5Ek4JsbCrrQ8hKDujfIXbCoO7VTJmm21SecZ5sh5dzfyz
D1vRIM3q9pW5X4AfmmYRLz7LMbtJPvrTx7BBeLXTfPgImgPIDw==
=h1WB
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
