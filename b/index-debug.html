<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMCP9EQCo4H/En/0usBWV4r2iJQAEbsXZBug0/dLKaA693THxU6E1BHVi3K
fET8gz09vgkgMHivVlqET4s1LaotOkKOb4oZfKmAn++K1VULrNE8zMSizkOv2BZz
P1KT8DWD+tNIVR3kodfiv4BwvX5gzgyxIk0B2y5WwMDpU4aSUS16CCkX/wqgJKH/
kZAXQjCxeq+VoqTMkQd782EbH/BKiuCuzOowQusGExCQYIXJhxTwQy0SdYTCPle6
0z8zVX7pbb8ZFu2AkmO1QZVtP0LVjbwoseLN4OuKzQ/3ADwcaGODeBGDPGBbrjul
3OB0QsniFaq0/+xGG9hhY4Md1UyCFw0kqWlSMt2OtuCRiMkJFd8lnWJ/7NMe8Eyb
jekyE5AH32Y+/QIfkcjkhRtEfqLaeT6838GlFRT8yuUVzsE9uiysMYpBH1hhqrw9
pQXJmCZFW+RgFAdv2u7cpPRDG6QXxRJZA90hTdeLyAwIF/axo31873PD8BJoOYyC
aKTRmLAc8UUvXAP0Ku1GYfl9oJ/X673NaDwnClILHOqz5AT2lGnEt9MqaDOXE6aV
nq2WGcrQsoBkRUqblC2yuqWWDGx0JGcvR7kusFWYtUe7Bn9vS7UK9SivmR7+P+Rj
pDsdH4+WKczH2K/vReEisO+qhO5rlJ9/FADr0+iltVHr0WhhU5/5HJtqDCE1Lqhc
hxDTEr7PlkoftHEqlgLxgpYjeoeHR+oZ1elg/gH30Z1cHKqQn+E5fmkwaKQHMPSt
ce1t+UwvpDwMRVQXSTtU5h6TUg81RdE5jCNYnwuAN1slS9b18RTyurBp7gxLNNcO
wSUrr9fkkcxsahFPayTBH6Mal9LKf69VyZ0wmXQn0HdsUUZt1sBZGdH34WEzq/pv
7XfHHtO3c7/Pz51vqErUmKH/7v3iLkkIfTO1YoYrW/GqnW2vxf8Zt89vUOjI9Yz9
5BZ/eq8DxGR0uE7P8B20w6Y5e1SAa9CgWuHVWhABT0cgFEavaZDttMC13fxqnWIv
Y6SCJWR+dmNEvNMlzf5+z2gsswNGrVytfg+O4FTUXh58Ho/Oi3pMRBEcncUqJYbg
czwsiTH0XG0K+hoU6iVN/d0ghDC9WhdRrZywIfA4ANUN0EgSP95R08gqxbEg2oYD
6yCiIYBaRW2AUsJPwwLqokPJtIt+xaDOLRZVnIm2bnAW1dNm25vJziNu5FWkTa3Q
IPVW17x+8pKlBcYJffzRr3oRQbdqDc47uPMhlOm0NrFJU00ev0eN41dhg+qSpLuW
FYHIXFMpCKi67fgNBc3ySHXNIChpY7x4ZYevUqbyExbnKL7xVgbNSVwey5Dxdygy
pWqC4Uewg65RtXK+QLgL2l/URDT18ttzEP608IHzDwnwPfYwSt6SoOHJS1u2KwCg
OiPB1kaWHc9X4n5cYyDoAKhwdIE9YNZgVGrY0jcAMGIZkE0i6gYwtPYBS3jXM94O
P733xwRt+uAxKcAm28n0dSCT3cqbR9xxNKWP7C8opeQl4oqXVq0KCpitE+U3DE/f
i+zTehU5HSf8ExWF8lFAPlNPFlwDkRQ1aDWWOZC/pCBYRWeLdPJ9Vp190gfGNvKV
WWgNLwh65RLCHV8TaiN82txyFKKr2tnd6jCu9tmHyY4yQXPUpCto0lpv2jxTaVA8
P7roKUvmd6eDuPLR2tc+7Jre2iX4YsNcFSnHVpx2BMAZYAWc/rsLTJjTWDrJnI4b
l0esM6TH6hAx4iW5QcmuotjTjiTEbMonA7rQp6elF48Je8aJSbPOdWLUqK3aOeiC
phm+O3P7YY7at6b4ChO7P/6OsjSBDPds8ZhEDsW044RYONB0VRtCPA4MgwzAAZUC
TKUIkxIF/XBpptAyRhp/M9DUAWsUu9pLjS5IMBRkgAD/r7fEhnrTbPr+iYZBVVSp
YvyYrJt65UFvCihKC2rFgSawTW+qnSIx3p6+3dr+rOq8qgIZMGfVArUYp7ZXPepo
2oOdkRHtwT23VrUxqY6DREfqucfeF8/zcqwx1PGkFzEMD4HZjpH8kA6bdy+lHn/D
X3kULvYDz/9WV6gGa9RzV3CE/7LtFiy3gMVSWE2iSnfQAgefp+LRgwlXorqdlwbG
+mAvPcnkb697f+bvXhfRbl9mwnSoscsx+ik/ahumjqF4YxWGhMk/EKy07um1ZOG0
fEmkEFVJToEji+GQCPbRtyGhAs8ArP8F07yR6baQyCJGC0JWTC5DcDiccTuMmn0Y
d4PEiuzfl2viry7Cl6iVxFwWb9JRgkJ2JQhCvN12QL8j+qnJ1AgqMunA0JpUAdBn
RgRdxKOO8dL82ifAp0ddO8Kq0RU8nCJKoy9irowUWvEXk9j4FW/v/wMEdGbd0qCQ
qQrgqZGjMbWodAElPOt9RzAddm3p6vJ+NOWCLGnfBD2fkJ0LQfQOAcnir4oit/lD
0stJ5TQaUB4yTwoyv+K5xm0sP0R2Pblx/UXZ5T2B4PFzPej0Exq9Erepo4+japnU
KKlh9i+acRA3gjphKD5Tuz7kogEoGK0j6VfoD02/e/uWB5BVJaTk0ynu72s7abtE
XdntrMv3/1dhSACdLgFDYxwvic0wWDrAUKVrs6XZNISXJO+2I2h+MMky/IX4+jp3
M2gWbrgbCBfoX+tLjn86Vz94XRAO5gWvPj89Zhkl1WJ73Ti6dosnEHpKlWkHiDUz
w7wGj9hhrfD+bhY/DMvydsQY9xlw4cHPC8mUhPH+6VAiei2fzZ2/eKu1RpAa3xw5
A+pF9eTjW3R90Qbm1GXTq0SEt05mazPQDouuF4Y3YIHwWCI5pje3vJlpsJWLn8Uu
sGsS5FA3wfuQsoAOYfHKVotySdFlT0VPuP0O3Q5Socy9YMC/fsKAvng/e4Gl/ze1
HuxNKCbpJW2n6eutIU2DmkUIEOQSasbkFnZE8NPkr4IbsSGobIw6l/Cd4cYzf1AL
8SXI2BtVzFxJCP0wvlLwYyE6fNdJ2w7XWy5wDWsfb87rpbC4KjG8S9HTnInzq7RS
JPgdudkAbVyVzLq90Dk5tQoC+bKbajXiF36N1gqyYDMMg47Y2t/71iUDNMzb5k19
tapp3GUhNnSgfLxno8EzcYNCJBuVW1JuWXz3UUus9VDvct2pxH7Y/77jZ5JrK/P8
AADDbVZJ0rsRDeCpkWvBO0dQ5PIYsqdGlXj6ZhDRVbTdaHoQXH33hc5KMvZu+5J9
GmkTKOJLCjb5SydpCAH/VNzULhO+YcX792RHQ0GUYerAtZSnOdXfMY4k59/ZZwSI
MgfkyObijSSYdg0veUdf53aQDeFi9s42oPpu+rxRELgptjJGkWQTpBIVx76V4BF3
dmHk7nRG9ow802oEqMNFXfaydZeFPG38FB1A+2vxo9O1lasB8c5rDTKWBi5YiQtg
Rjva462bvQ1ZZakn9EOqJ7cd8QSEii2cKOtzQWhS5WodOJghsunkCvJAUy5R+9GG
1vzZDaYK6dwsJ9ml+8gESuaPTzmnprTqMqLttJKj+IPFxA8+6+ZniLUllBzrmkxJ
IUR0UWyZe7YkCi1q4FcSazD42Xocu/HX7cZW8qDfNZRVCZR1MmButiQtNzlCeXq/
zNHOVQPcU+NRD32MwHIkjpYYJ9hMQf5MkDotXoKKzZYM/OMTspV8N3rlzIZOROrQ
dExYHdP8qkyerPp0dIZkvgLiJ0cIGkam1PbX73FPVOQK3RsMOPVQQeuLT4KIJtWC
BXrU7c2QzsaGSCh1XrnayouPBb8DhrZeWH2sILVNvSJO/N1oZPQwkj5E4jBiJydW
VwopVASVllndgYsV5gUxjOKO4WowvBA04APNYohXmSXFp+gfIyAQLkHLGVcJyS8O
uUYkDxUiAsF/mkIztqfk0mbl66vHYBwr1bThZQRc6s5flQxoBvPGmP+DxM0Ru2CX
dj8up3OYHl110ffUMLZLkLUPmJ0M9cgVs+lLLs1+9GxYhggn8R+PZat5gnMwiGcm
VolcheKu/UPQKlW3Wv9umj7DvCSl4WO4v4nOGmz1IxbxMD3iHkiLGK0PpXyVoUaS
IuZI2HAEIFaOYmRVT8plYzD1NTIkaZD31EkpIzHvmxu8KwF6ym4Ds1xDQATQ88Pu
91LLjpxSz0anhV4ciIalHtlmwDUx85N7UKILIk4Ayb0m+v5aJrLa9RLGThJ1Y19Z
J5NrP3ZRpuGd0NSGQPNEPVh8j7Amc88J/+UzTMrtFwwhDhshCUPC7qN7ZenIUK59
Y3CuWnIwGHMjU3ZXHa3cw1LDUukt8ViaYw+7L4OsQAdm9pdZOymtUG8vDiT4pMxK
nOTUXdtx1k/FIhc28xnsdNbt1Q2aAUkZzlhtZJC1cNQ+3gK2dzPMiQj1c8Y/FL47
d/zsfOcO3e+zLN5CJBWhdkBWgofvqxThV+875GXsYsLF/YITp51iHde7zXsuSSkJ
29VyU7gcVHIOpakTtM2BHBHNj73dAMHAHA==
=VTwH
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
