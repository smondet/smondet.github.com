<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
TKMgGBrbRD2T01Q9BCs631258vM4tRpfzw==
=qA7s
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
