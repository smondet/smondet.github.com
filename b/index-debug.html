<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=HKdE
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
