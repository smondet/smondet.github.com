<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=4Kvf
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
