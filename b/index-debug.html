<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMC11vJY2zqQZL/0usB6+w0k/IocBPJjGvyAZDx7QjLNsdQELJshTL9E/11
49rJ0MfYT+C5XUa17KOz0a81tWauZyPV9UgK7Pne7hdMIURvvGWp1tvTJ0AamcQB
AhOagT4vTFp4zXuBNaCuU4ZWkbqWyzkeCMtH9uHgSXEhseKR50GN4VlFm5BialWw
qXFkosHVmvpg/gC8D5XI5Hmi9aF0mtoQq3zGyEOjovNp+oosgibUD8pw86LK6sIY
pM7wnSQgNqeWeXQjJIWZbiQXbDElVzxFqoZDEe7UpreehOAq5jkpYVCuzkZk08Kl
mA2Q0QuPRFr2PO69cv89y6aRlibaApGby3FfebbPM+W0LmwuWJhIgqFJcRdondA7
XV3oRPdij5UZjDF+lbhvzZdHXTe8vRunaq7aYmvxyQxe5MK/A88WbpUshePIFXuZ
p9vuHh4EfuzQrW7lqW7QCm8M3FkjnwDo5MbMsAucmPL0jpqkvUNjKGh0/enHXxUK
1bFL5xMMkbzZT1ii4cQeDkdeVOPtY3E/e5GaM+SDs/3n0D7jv7b6y19E6WPA5FLH
2BhNM5EkGQaqy680FZwYuaDJ3L3fPm/fimUf+kbJO14cNszHLIMk08RWOYI72g+9
D11zCy8Lt7zqsmOLEWSUYgTL4qcUKjzxYxf7fJ0hhOt6Dm/48VjpW7JlN+Ovribq
x5tH5JH3Coo5XrhDMAR33rsG3vMZS8HpApHr6iC4FUZtDEom0LKHxtRVy7IIQHQG
TMii7fKXxBSXg4HPHz+YhabpwvcGroB/Arue20MqA/oTtZmaPOqaCM+PV8fL0ArC
I1pbza49BkOkFCqJ0pZhHOL5x8+XsV9kKUAl49SqBnm57DifW3NqOZw2PKeKw7yI
qrUToGxdsk8c0w1wDoSpD/U094QlMbQ5L7L0aDkyOmaYNlvTnf2qFk02LvVzWAk2
YA4Zb1sLcAwhVBbs6/zR9UKacRrkGyv+kS0NgUPmVZXjNU3JN58uk+4Wi2ZJi0kE
fRIh2mYCv5ive9hxkzY/btBJtzohZKo3Jn1Hwo1IHwJ2iVbdhpUZivwSeFXNtLT6
yYc/CpIvslpRPpeFBG16Ji60buEouc9NpJpgh8mkitNoMRedIBAzqzQgzMrhVNoZ
GtHa2EcJdko3oDWHQ9Alv0XW637m9EtVXzBYMW2UzniouZ54lJl6hk3ZFFOmIXfN
Xt+c+4uxmhpGJeVuYelh33Apy8avgcfIqvf5K3y38T1xUO/jN/ecQ/J3V3XFKShn
p/10AxzxzVvyJoNdWJ53oXTEhxD2XWsI4SRi1/2lKioZeGjShhcqNFebngzSRS0M
RW5UTWNPuMJnWv0U6j9VkC01mdBKdMwy9dkxjoneyCtXcpi+2Yal6dk44Pid36vw
//YgXraZ2yIPsPI1xedsXhHAVbPysccf5oyO/n8gOo6uKgHUVHnXvpOih9XlUqgH
wuXGx1DslHAkDBj022a7Sh5G9olRGsxpVkkwHPQxyEWsmkQsgh/5je8CHt+VeVXx
5/Uj9uUk99FxrEnBgI6leMLRQhwQ3XclgR6CdmNnYzp3LTMWQSLU12KF2f9KPQdZ
BjTw7kHSHKMcY69Fg+yEeq/r1via+NMYC24QsKo9eA/3/XLLbdHs6mBroq9bRr98
m4CtMY5FosODK1rwCk/o3LuwdIjr5uSRNBKWDEAOR5Xyb41WIsY+QRCE39O8PaiJ
Ke5rz0GPA6REKmnWml0CsHs6pV/zUeh76wQKblxRBHmVUQtwxW4pNXb80sewkLtM
+iimyUrZMbEL6+ST7KZFjhWcKDkF/YVPy+l77oEmmJtk8eofHTeXew56wNdY8tbP
IqmGrzobjy4N5BVeoSs/KdX051R985D/sJJZN0H0GTVIUzoMwqOO19PYAwx3/qL3
60AbucQStuKvAVgeBKQ8Rx4/IaDTJTGPeiRV29uMWOK7Y/ejf0saYypb+DT50dzg
WgGX7pO3UQILEAWjrgR+7lvBcmGfjZOtYXzyMrpmUwQe03I3Q0PEJuN4PHwcMNdB
IY1Yrs4R8uB8scw8rTpFL56RS5aKLg92d34opynMeuS13xWBCsnqL7H2JI7z7NdV
Y1xJWDh49PdypNWP1XHcHf1bECCHgZj/wfnEZI/S/7hUhzsf53RwvP9ZdXBmCGON
JcCEQmoVJsrocjvXhhl4X+RTkZTKDRcEMB5QDA/nTNLi2v6B71zLYQJW6Y5wvFEt
sbQ5i/Dc799A9g8xx72T4gdraXXX+thEaKB2ab1Wz5WxuVUzPfEXsUwQWNGn+9ev
xX7TAjcanSCNB6pEflW/a9Az3t33K4BEUMiE4QCSNhN797ywVAokBjqBS7hZRARo
uV4B8yGOgLWwgcGkObbzNT8u8Qz4zqzWw7Vc8tQG4PH3yyO+08TqyVer2Q4XmAoW
oRSQ8f2Gp8FGLmznaMiY6Qt2XZO+xTCZrqmrMdHFTQ9cUKlZ8Suz7d7gs347ODqE
uTi0xLotUi8lvRZ98P3ib1fQKJpkBZKmOXILp6h9Nb39otoTq5cG9UCdAL0PR6wq
5kwUSLLTgtL8L1YDEVoV6BMcTG4eTZbiqzlPHHlj7D+IwkXB1ghMqmRxnhE6191w
XnQx7rKyjRA6ez4LieLUKJoWJe3QNiTZzJHPCRq4a0x+WBjHGzqPmUdCR5b1XAJ1
pxiRPXtUvxWfIrrn/Yr4isA3F1IxD7ZPBGak5DIBwovF1NdUBHTBwbNY98/O3bjU
Ymyzka4Eejvc1hG/SyhGbjq34PB93NvySmWaP7aeGWLKENJNt1FiRgC1hzXqSfL6
knxWmQ0VAkdYT1gKy4Ek+qekcNMkJ/7SP35ip/2M2dIJHUOg83fCwa8o87mg+lwX
PDK36pwIY9LaJqpnrEY=
=fCuI
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
