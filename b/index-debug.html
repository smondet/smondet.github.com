<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=G4+O
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
