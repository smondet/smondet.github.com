<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=z5+Q
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
