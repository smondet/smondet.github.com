<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=2pHX
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
