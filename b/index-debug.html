<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
      integrity="sha512-LsI4YA/OY2EMDyHS4lWWUweqqcQXRi5RACGFsemrbqQAguNpNNhjRaJcua7Pvu+SZxGR1vbINmbRM1StWO9Z/Q=="
      crossorigin="anonymous"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=vRlV
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            var meta = document.createElement('meta');
            meta.name = "referrer";
            meta.content = "no-referrer";
            document.getElementsByTagName('head')[0].appendChild(meta);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
