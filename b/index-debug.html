<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=TIMJ
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
