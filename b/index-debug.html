<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
FMVAsXOOAuI7V5AH3YIdQ0Q=
=x81i
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
