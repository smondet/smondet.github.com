<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

jA0ECQMCOf5W0RfvQVn/0usBi2PfcAyvD+ry8i8pV19luphQ9L4AOSEFCyIQT0n0
lK96hoPUG/58ghSOvMlx5nIiH/MpQAc54BR0V1S7tEssK6A0UkD7Bh1pyCIpGc9r
2YrhZTHv4HHFWb9xGAERdWoHTu0USzwoW5KacKObudD8aQ4PdAeLo5Qt/9RtwPu1
28sTABIMSOG8HrEIfizMaTBI9W9TzCg7qZM6mXUxy3SUhamWp+Gh+cmec2RmK+JD
wVYg2lv1ObZQlaNQLbGZwB3p7uQJvoi5mcKRZEBPn3sruU87nkn0x3pciTTUtW8W
QDH28JO7ZfXj0Y3xWUe4KmohGc5z1cjsg1v7gS2I5siMgspeQJEPvgZYlR1Mo2iU
06XW6sbwX4HZ1PL+CokuvT1UiUg5SIMMrsWjrEa1A7KkJV01CeH7v/0nhYWGiWcE
y0+pXJGv+oDwG3GitfwGsxekADI0pNKvZL1FKl2RnbRe6EzzH4/ww+ZCrAkbmVUm
6Mg0n/rCKfT7nHtWwhjRvb08We+T3ZTjoaf39slpXEnRhxD3RHMmP/hI0YtKpcHf
hiVdH/qpHaqHq9d0IwPcyj/ScOyndvmhuKa0pd5RwSAAoRC0Q0nIhgWvASyRRZNV
yIRF1Xq4HEsG9LSnFBAj9XKm9vWNd9l93kPe56y9G8j1N9MQ3u6M24jg8+Iqri/K
Y6g/PB+BgfIkEbJkRAF/j6C+FtG355dxSOxJMhWz69j6FefEDhe6BLnUskvg7GuJ
UIBGE32l5IgTe73fSQF7ixkfLKDzLMk/ZIDczK6ZnqVKe441/AaTOck+FgrSrUdZ
b4NWGhiseBdsX8NpE4bUFJ8EYppFtlqJOUFHdg8+LF3Z0xDn78NKmftQXYLBZhLu
f2XrcYn0QeLyOeWyrl8z4+MBV6OI9YKXEKiOvKIXw9xF5Ital/dtjzi0nyK9Wh+4
1w7JrzCiqKP4ohSG769eSNtqs8X2vr6RdeZkFdv6pG3JS8Pch/JwqoGkP2sI4WmK
RGJqexuFJvyiC5xqW2y74wmLJ7BLrPxslfF1zheCfBvwqW0i6mLxCSQK7atMao5r
x8wahYDvfUTOzUb9AmB4gqvfONQ9AVQjV/Kai4uEH4DuFlGDT1sVDWEtEDYUxtvn
RNFG2xBc3dvxcGyWtMKk9u8kG4TgT6220iPoP5U2dX0FUEK6pkD6WG/NZo9Ysa6n
L/2GFbzXq8HDYYLyfnW8QCHKoPv4YqQcZmpHKWlE5iK8sWUC9xa7u5GkaSk9Ez7S
XwMy6H55i55QUvxx2IA7figDglSfytqy/hMeq8R7dS9EFNc1rfe7yaoGalAZbsuo
yAEcX0UscSsLHf9W5YbgoMU+mk3saVByDVqPKfXQzSM9tKHEQ8MnTC5atWQV2AYL
b+sgVjvZN1fZG5QNGHpF9nBUg3J+RdUQWCr0bxvf5mBEqRdxEJvk+42xpqbYyGBs
ImWv1PLhOuvRc0GNV59EBkVkEtaIC3vJC6pQ0nTengkI53uwbWakDSVKlQ3kgJSs
wiikptwpcKZSH2b68SISGvrVf7I85cnAVzQnRvmnFWcRpyjDKrvAGNZXsXXABHnr
0tRzOQykrJicSOYy/5ILgdrEeFnZre2ivuQBxIh4SDozEQGM42XusC2v+DGb52Gv
QWTVKBw7KpTNbER5w2NdjCOEG4VK/phgbGdWFKPaR03nd+lPjpr2kgwYEL0qE7eS
PrDiDSlDsMjSvUfSgdwaOYfvxFV3QAkZYU2AVBdVIbyAyXOBm9u1IK4YhNnnhzz8
Lec/NsSl/m5EXqMim2f7H57c8rYAGb1yupXirmaYS8IukaXT9MVeOWg2KS2XrKi3
NkmSb1QBFBNv080iO71ZpPHqrWhgbKHMJtBSnUM0Yk5OTDXZtaFnMcuiwZ4hf7Nk
kTj8AEDxM+sTdOgQJd3oeeT/8R651VWEU0AdVK4/Ku4fWCbJaajimAreRoQltOd7
dER8bBzm8CHChksH6XIig3whTDulD9GrHVrXACPobhxuB9K3Deu/Pxjd8qQalgj8
uNKw3gei7Cck35SSWfJ7B92MWmrdkylxwXx48DNaqw2KRDROoOqjw/y6xZqpwKJM
Y80q3XXD8pfUWb6UZG3+iJZKi0roppXhgX3LJUhavoxjZUxaIHAoowdhjtbpcpIP
ybqKLJD7bvPPyq2svcbLAU4P6n2ywiEHxiK9z5IKlg0QMcKvjfPsMq5OCTB2S63d
nlNy//A1AYLSvP51GJ3ShQvw/VCcRi9orVUKn8zmnoScDyU88dn1vQ1oYiKwJQ/1
993w75RfRWjjuPKtFYP5nyEOGSdgUVrC+o++9O8BZOU9xDePVa50ZctsrNusefVQ
lhG+4wmBCkYqvBR2ZoDu93rqA7eldVJ54hsuF2wZ9DGuQinCSBDBte39bTLmxV64
QVjvKKFR5vrqaLil6/z4kia7yoUs5kM9tZ/SHHPyLsF3l1LUg6X5uk+Enuhi0ZYE
M878WZRQ3bWzO4OyMNbcYoR41+WGJkdFOr/kr+lcxLtd/S+yrttHQ6ov8orchSKh
XFYB18jlmRj+rDVOKkl/NkI9IoYcvIDJU/lvaJl585P40iyKn+bNrup8wK4x+7T5
BJMBtGqLXp7JZ8qdb0A4QvEGlUMDw6wHlg3AZuJ2vjivE3l9JzpRAf+N9hmQ6osx
1m7teIYu8zKKyS5DKxQc+IJo1zkjLy7fbbS+i7/yH6kSuyl05e9LabNfS0iNGnNh
R+oaBZtWekdXD2Alu/8OG+kWZOT0L9egoJGj1E5k0hcZkx1HyM/s/2R66j3smQOT
OmEDFklxEwq1B6I38M2EdeTSZ1fnOn0kgqYGJno1q61szG/8b21Z4IycNQtODe9o
p6uarYfaCMVeEh8/HDh8ORwWuiDf1mhgYfqSbQazVPlN94fh+CHD2ZOWzM10oI7t
TvVJgPmP54qxGpofoQdxh++l5o5McRbZd6pfzlRi6eAEJvv1iP6BLHMaOgqgvA4v
ew3bpuAZXqY2uBzLJRYPe2/C8j+06E0WHY8sn01PuVWRQy54H6rQnjIbT6JAveIz
Eip8hV7f4dBUn4feohx8ewySnuL4rL94wjTSEbpK9CpV3FejWBM9WMjzpTlaP7lD
eW2mBN1s6VsKaMbnwi0it3WMPTfbwqJ9JGnxRfdR2vNYHNuu/bwDPNAVbhfd+Ez5
pW/OsZcrPyxqIY6t45NocWHFzb7AqhaxcS7zzbJP0/WRN8BbMgxwsWeYtNuRh+4z
zvxYvEHEcECoobo/mtkXqTIMu1+uT1TAW5sesUoO4w9YYS7iWSZPcnFeLnPE+Bn7
YlaOA8r3rz9WpCIsSX8JvVUNV9LIR/EjCJGQERusVRwQI5OIpwAVeZbt3rIlz3W/
lPJZv+a1jUXl/pDmI4c8lslQfYLkeRnI7QcHezcq6DoYgXFyw0Z7hVCmM5vRptBK
T3fin0wZITrR1/1IWgcf4H4aWyj3acZFnayfs7YeAze4I+334FMvCtiufU2b4tAS
2xpRhJHGLDBzakF1MuRX3SQJE+GzLza2cZLWs5rSx2lxE/HUqPVhiYUHxVWhBb6t
/ihsnkYYH/OoY+7YuM7ql1j1INDKl0DFyKr7GLE+5ywqW6y8TE63wPZysitzB9Uz
2OsJMc8Htsn4ko5C1VllDB4O1G52gJNCBSPbSGhWMEwTbvWQMppxocdnr6s3SIHZ
sldEv0oeWeX8ycXMjcZLPKkHhqjl0yQThW1+JqCRyRFRKSZIz0hPzLthhJWTh7pg
XiNKwiVOSKR7ErOHLzMr6Pd6oyabB1zBH7icd55bBStWylShxbxN8VfI5pbzFwQS
keWQ53ElRbyqA+3ktgaoRC9h58ptuJlwvl/yoDXlMBhmD55pozf7UwSKR1LHUQR2
zfmtOQxblhcLBGbEKM1gGVGidKMVhNmFtSdbfMNa0vGmArJ1+B36h/tk5womaTYC
raTBhxsn+Boch4/24eqS9Vg5S1Lo6ZpxO7zquy91+P7V6xYZfqNUz4HthbUd9TBS
NbUCxv6BS+wt6fneRGS4lO9SW26O1ifNy5QhNNLu9kJgu/ctB7Imm+cDNZ2kUXXm
sPe6bYFDvzvNRQ2HZSIWy8/mNA4Spyfqd8nSi7ZEmw2n9XbvNwrfpONfd1ebeduB
3OHhin7rlhUH12BqZbMiHlQtKTSa6Fs=
=YmFg
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
