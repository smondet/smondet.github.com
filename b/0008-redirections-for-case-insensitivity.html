<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
MhMmVg0=
=Y2Fl
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
