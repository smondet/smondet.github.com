<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=+H0X
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
