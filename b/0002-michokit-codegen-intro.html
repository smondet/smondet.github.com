<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
LRMfoxYW2RT/6bfA17Sk2yeYQreid8ySTA==
=Oqmc
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
