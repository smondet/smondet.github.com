<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
=z8kE
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
