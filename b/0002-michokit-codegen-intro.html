<html>
<head>
    <meta charset="utf-8">
    <title>Protected Page</title>
    <!-- do not cache this page -->
    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/4.0.0/openpgp.min.js"
    ></script>
</head>
<body>
<h2>PGP-Encrypted Page, please provide a passphrase.</h2>
<form id="staticrypt-form" action="#" method="post">
   <input id="staticrypt-password"
          type="password"
          name="password"
          placeholder="passphrase"
          autofocus/>
   <input id="staticrypt-form-submit"
          type="submit"
          value="DECRYPT"/>
</form>
<div id="errors"></div>
<code><pre id="armored-content">
-----BEGIN PGP MESSAGE-----

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
GFIWMvkTPvM=
=nouR
-----END PGP MESSAGE-----
</pre></code>
<script>

function tryPassphrase(passphrase,silent) {
    console.log("tryPassphrase " + passphrase);
    var openpgp = window.openpgp;
    var options, encrypted;
    var encryptedMsg = document.getElementById('armored-content').innerHTML ;
    
    var armoredmsg = encryptedMsg.replace(/@/g, "\n");
    console.log("armoredmsg:\n" + armoredmsg);
    return openpgp.message.readArmored(armoredmsg).then(function (msg) {
        // console.log("msg " + JSON.stringify(msg));
        console.log("passphrase " + JSON.stringify(passphrase));
        options = {
            message: msg,
            passwords: [passphrase], // decrypt with password
            armor: true,
            format: 'utf8'
        };
        openpgp.decrypt(options).then(function(plaintext) {
            console.log("plaintext of msg " + JSON.stringify(plaintext));
            document.open("text/html", "replace");
            document.write(plaintext.data);
            document.close();
            return true;
        }).catch(function (error) {
            if (silent) {
                console.log("error: " + error);
            } else {
                var errors = document.getElementById('errors');
                errors.innerHTML = '<b>ERROR: decryption failed: </b><code>'
                    + error
                    + '</code> <i>(usually means wrong password …)</i>';
            };
        });
    });
};
console.log("Setting on submit");
document.getElementById('staticrypt-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("on the submit");
    var passphrase = document.getElementById('staticrypt-password').value;
    console.log("on the submit passph: " + passphrase);
    tryPassphrase(passphrase, false);
});
window.onload = function() { 
    var firstAttempt = "";
    if (window.location.hash.charAt(0) == '#') {
        firstAttempt = window.location.hash.substring(1);
    } else {
        firstAttempt = window.location.hash
    };
    tryPassphrase(firstAttempt, true).then(function(ret) {
        if (ret) {
            console.log("on the else of firstAttempt");
        } else {
            console.log("Nope from the hash: " + firstAttempt);
        };
    }, function(error) {
        console.log("Error from tryPassphrase: " + error);
    });
};
</script>
</body>
</html>
